<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Heitor vs Tina - Edi√ß√£o Sonora</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    height: 100vh;
    font-family: 'Courier New', monospace;
  }

  /* ===== MENU PRINCIPAL ===== */
  #menu-screen {
    display: flex;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url("background_menu.png") no-repeat center center;
    background-size: cover;
    z-index: 500;
    justify-content: flex-start;
    align-items: center;
  }

  .menu-container {
    position: absolute;
    left: 50px;
    display: flex;
    flex-direction: column;
    gap: 30px;
    z-index: 501;
  }

  .menu-btn {
    padding: 20px 60px;
    font-size: 24px;
    font-family: 'Courier New', monospace;
    background: linear-gradient(135deg, #8b5a2b, #5a3a1a);
    color: #f5e6c8;
    border: 4px solid #FFD700;
    border-radius: 10px;
    cursor: pointer;
    text-shadow: 2px 2px black;
    transition: all 0.3s;
    font-weight: bold;
    width: 300px;
    text-align: center;
  }

  .menu-btn:hover {
    background: linear-gradient(135deg, #FFD700, #FFA500);
    color: #000;
    transform: scale(1.05);
    box-shadow: 0 0 20px #FFD700;
  }

  #menu-sair {
    color: #ff6b6b;
    border-color: #ff6b6b;
  }

  #menu-sair:hover {
    background: linear-gradient(135deg, #ff6b6b, #ff4444);
    color: #fff;
  }

  /* ===== MODAL DE CONSIDERA√á√ïES ===== */
  #consideracoes-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 600;
    justify-content: center;
    align-items: center;
  }

  .modal-content {
    background: rgba(0, 0, 0, 0.95);
    border: 5px solid #FFD700;
    border-radius: 20px;
    padding: 40px;
    max-width: 600px;
    color: #ffffff;
    text-align: center;
    box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
  }

  .modal-content h2 {
    font-size: 32px;
    color: #FFD700;
    margin-top: 0;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  }

  .modal-content p {
    font-size: 18px;
    line-height: 1.8;
    color: #f5e6c8;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    margin: 20px 0;
  }

  .modal-close-btn {
    padding: 12px 40px;
    font-size: 18px;
    font-family: 'Courier New', monospace;
    background: linear-gradient(135deg, #8b5a2b, #5a3a1a);
    color: #f5e6c8;
    border: 3px solid #FFD700;
    border-radius: 8px;
    cursor: pointer;
    text-shadow: 2px 2px black;
    font-weight: bold;
    transition: all 0.3s;
    margin-top: 20px;
  }

  .modal-close-btn:hover {
    background: linear-gradient(135deg, #FFD700, #FFA500);
    color: #000;
    transform: scale(1.05);
  }

  /* ===== FOLHAS CAINDO ===== */
  .folha {
    position: absolute;
    top: -80px;
    width: 80px;
    animation: cair linear forwards;
    pointer-events: none;
    opacity: 0.8;
  }

  @keyframes cair {
    to {
      transform: translateY(110vh) rotate(360deg);
    }
  }

  /* ===== GAME SCREEN ===== */
  #game-screen {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #87CEEB url("background.png") no-repeat bottom center;
    background-size: cover;
    z-index: 0;
  }

  #hud {
    position: absolute;
    top: 20px;
    width: 100%;
    display: none;
    justify-content: space-around;
    z-index: 10;
  }
  .health-container { text-align: center; color: white; text-shadow: 2px 2px black; }
  .health-bar { width: 200px; height: 20px; background: #444; border: 3px solid #000; margin-top: 5px; }
  .health-fill { height: 100%; width: 100%; transition: width 0.2s; }
  #heitor-life { background: #00ff00; }
  #tina-life { background: #ff0000; }
  #laura-life { background: #ff1493; }

  #dialog-box {
    display: none;
    position: fixed;
    bottom: 30px;
    left: 30px;
    width: 500px;
    background: transparent;
    color: #ffffff;
    padding: 20px;
    border: none;
    text-align: left;
    z-index: 100;
    font-size: 16px;
    line-height: 1.5;
  }

  #dialog-title {
    margin: 0 0 10px 0;
    font-size: 18px;
    font-weight: bold;
    color: #ffffff;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  }

  #dialog-text {
    margin: 0 0 15px 0;
    font-size: 16px;
    color: #ffffff;
    min-height: 60px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    word-wrap: break-word;
    white-space: pre-wrap;
  }

  #dialog-hint {
    color: #ffff00;
    font-size: 14px;
    margin: 10px 0 0 0;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  }

  .btn {
    padding: 12px 35px;
    font-size: 20px;
    font-family: 'Courier New', monospace;
    background: linear-gradient(#8b5a2b, #5a3a1a);
    color: #f5e6c8;
    border: 4px solid #3b2f1c;
    cursor: pointer;
    text-shadow: 2px 2px black;
  }
  
  .btn:hover {
    opacity: 0.8;
  }

  #heitor-container {
    position: absolute;
    width: 120px;
    height: 170px;
    bottom: 40%; 
    left: -200px; 
    transition: left 4s linear;
    z-index: 5;
    image-rendering: pixelated;
  }

  #heitor {
    width: 100%;
    height: 100%;
    image-rendering: pixelated;
    object-fit: contain;
  }

  #tina, #luiza, #laura, #tinatriste, #vodidi, #vodeco, #tiad, #tioguigo, #tialine, #violao, #tiobruno, #vomari {
    position: absolute;
    image-rendering: pixelated;
  }

  #tina {
    width: 170px;
    height: 170px;
    z-index: 2;
  }
  
  #luiza {
    width: 160px;
    height: 180px;
    z-index: 3;
  }

  #laura {
    width: 190px;
    height: 250px;
    z-index: 3;
  }

  #vodidi {
    width: 350px;
    height: 470px;
    z-index: 2;
  }

  #vodeco {
    width: 300px;
    height: 470px;
    z-index: 2;
  }

  #tiad {
    width: 180px;
    height: 290px;
    z-index: 2;
  }

  #tioguigo {
    width: 190px;
    height: 300px;
    z-index: 2;
  }

  #tialine {
    width: 180px;
    height: 290px;
    z-index: 2;
  }

  #violao {
    width: 200px;
    height: 200px;
    z-index: 4;
  }

  #tinatriste {
    width: 150px;
    height: 150px;
    z-index: 2;
  }

  #tiobruno, #vomari {
    width: 280px;
    height: 300px;
    z-index: 2;
  }
  
  #tina { display: none; }
  #luiza { display: none; }
  #laura { display: none; }
  #tinatriste { display: none; }
  #vodidi { display: none; }
  #vodeco { display: none; }
  #tiad { display: none; }
  #tioguigo { display: none; }
  #tialine { display: none; }
  #violao { display: none; }
  #tiobruno { display: none; }
  #vomari { display: none; }

  .diaper { position: absolute; top: -80px; width: 60px; animation: fall linear forwards; pointer-events: none; opacity: 0.7; }
  @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
  .hit-flash { filter: brightness(2) saturate(2) hue-rotate(300deg) !important; }

  .shake-animation {
    animation: shake 0.5s infinite !important;
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    75% { transform: translateX(10px); }
  }

  #pokemon-intro {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #FFD700, #FFA500);
    z-index: 200;
    justify-content: center;
    align-items: center;
  }

  .pokemon-container {
    display: flex;
    width: 100%;
    height: 100%;
    justify-content: space-between;
    align-items: center;
    padding: 0 50px;
    box-sizing: border-box;
    position: relative;
  }

  .pokemon-left, .pokemon-right {
    display: flex;
    flex-direction: column;
    align-items: center;
    animation: popIn 0.8s ease-out;
  }

  .pokemon-left img, .pokemon-right img {
    width: 450px;
    height: 450px;
    object-fit: contain;
    filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.5));
  }

  .pokemon-name {
    font-size: 48px;
    font-weight: bold;
    color: #333;
    text-shadow: 3px 3px 0px #fff;
    margin-top: 20px;
    font-family: Arial, sans-serif;
    letter-spacing: 3px;
  }

  .vs-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 180px;
    font-weight: bold;
    color: #fff;
    text-shadow: 5px 5px 0px #ff0000, 10px 10px 0px #0000ff;
    animation: pulse 1s ease-out;
    z-index: 201;
  }

  .duelar-btn {
    position: absolute;
    bottom: 50px;
    left: 50%;
    transform: translateX(-50%);
    padding: 20px 60px;
    font-size: 28px;
    font-family: 'Courier New', monospace;
    background: linear-gradient(#ff6b00, #ff0000);
    color: #fff;
    border: 6px solid #cc0000;
    cursor: pointer;
    text-shadow: 3px 3px black;
    z-index: 202;
    animation: bounce 0.8s ease-in-out infinite;
  }

  .duelar-btn:hover {
    background: linear-gradient(#ff8000, #ff3333);
    transform: translateX(-50%) scale(1.1);
  }

  #jokenpo-interface {
    display: none;
    position: absolute;
    bottom: 0;
    width: 100%;
    background: linear-gradient(180deg, rgba(0,0,0,0.8), rgba(0,0,0,0.9));
    padding: 30px;
    box-sizing: border-box;
    z-index: 50;
  }

  .jokenpo-ui {
    display: flex;
    justify-content: space-around;
    align-items: center;
    gap: 20px;
  }

  .jokenpo-player-section {
    flex: 1;
    text-align: center;
    color: white;
  }

  .jokenpo-player-name {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 10px;
    text-shadow: 2px 2px black;
  }

  .jokenpo-lives-display {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin-bottom: 10px;
  }

  .life-indicator {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #ff0000;
    border: 2px solid #fff;
    transition: all 0.3s;
  }

  .life-indicator.won {
    background: #00ff00;
    box-shadow: 0 0 10px #00ff00;
  }

  .jokenpo-choice-display {
    width: 100px;
    height: 100px;
    background: rgba(255, 215, 0, 0.2);
    border: 3px solid #FFD700;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    transition: all 0.3s;
  }

  .jokenpo-choice-display img {
    width: 80px;
    height: 80px;
    object-fit: contain;
  }

  .jokenpo-choice-display.selected {
    background: rgba(0, 255, 0, 0.3);
    border-color: #00ff00;
    box-shadow: 0 0 15px #00ff00;
  }

  .jokenpo-buttons-section {
    flex: 1;
    display: flex;
    gap: 15px;
    justify-content: center;
  }

  .jokenpo-btn {
    width: 80px;
    height: 80px;
    border-radius: 8px;
    border: 3px solid #FFD700;
    background: rgba(255, 215, 0, 0.15);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    padding: 0;
  }

  .jokenpo-btn img {
    width: 60px;
    height: 60px;
    object-fit: contain;
  }

  .jokenpo-btn:hover {
    background: rgba(255, 215, 0, 0.3);
    transform: scale(1.1);
  }

  .jokenpo-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  .jokenpo-result-text {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #FFD700;
    font-size: 48px;
    font-weight: bold;
    text-shadow: 3px 3px 8px rgba(0,0,0,0.8), 0 0 20px #FFD700;
    z-index: 60;
    text-align: center;
    animation: popMessage 0.8s ease-out;
  }

  .intro-container {
    position: absolute;
    bottom: 25%;
    width: 100%;
    text-align: center;
    color: white;
    text-shadow: 3px 3px 5px black;
    z-index: 3;
  }

  /* ===== ESTILOS PARA V√ì DIDI E CHURROS ===== */
  
  #interaction-prompt {
    display: none;
    position: absolute;
    background: rgba(0, 0, 0, 0.9);
    color: #FFD700;
    padding: 15px 25px;
    border: 3px solid #FFD700;
    border-radius: 10px;
    font-size: 14px;
    font-weight: bold;
    z-index: 55;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    animation: pulse-prompt 1s infinite;
    white-space: nowrap;
  }

  @keyframes pulse-prompt {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }

  #choice-menu {
    display: none;
    position: fixed;
    bottom: 30px;
    left: 30px;
    width: 550px;
    background: rgba(0, 0, 0, 0.95);
    color: #ffffff;
    padding: 30px;
    border: 4px solid #FFD700;
    border-radius: 15px;
    z-index: 110;
    text-align: center;
  }

  #choice-menu h3 {
    font-size: 22px;
    color: #FFD700;
    margin: 0 0 20px 0;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  }

  #choice-menu p {
    font-size: 16px;
    margin: 0 0 25px 0;
    line-height: 1.5;
    color: #ffffff;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  }

  .choice-buttons {
    display: flex;
    gap: 20px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .choice-btn {
    padding: 12px 30px;
    font-size: 16px;
    font-family: 'Courier New', monospace;
    background: linear-gradient(135deg, #8b5a2b, #5a3a1a);
    color: #f5e6c8;
    border: 3px solid #FFD700;
    border-radius: 8px;
    cursor: pointer;
    text-shadow: 2px 2px black;
    transition: all 0.3s;
    font-weight: bold;
  }

  .choice-btn:hover {
    background: linear-gradient(135deg, #FFD700, #FFA500);
    color: #000;
    transform: scale(1.05);
    box-shadow: 0 0 20px #FFD700;
  }

  #churros-menu {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 120;
    padding: 40px;
    box-sizing: border-box;
    overflow-y: auto;
  }

  #churros-menu-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
  }

  .churros-title {
    font-size: 48px;
    color: #FFD700;
    text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.8);
    margin-bottom: 40px;
    font-weight: bold;
    text-align: center;
  }

  .churros-container {
    display: flex;
    gap: 60px;
    justify-content: center;
    align-items: flex-start;
    flex-wrap: wrap;
    max-width: 1200px;
  }

  .churro-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .churro-option:hover {
    transform: scale(1.05);
  }

  .churro-image {
    width: 300px;
    height: 300px;
    background: rgba(255, 215, 0, 0.1);
    border: 4px solid #FFD700;
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
  }

  .churro-image img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .churro-info {
    text-align: center;
    max-width: 350px;
  }

  .churro-name {
    font-size: 28px;
    color: #FFD700;
    font-weight: bold;
    margin-bottom: 10px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  }

  .churro-description {
    font-size: 16px;
    color: #ffffff;
    line-height: 1.6;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    margin-bottom: 15px;
  }

  .churro-btn {
    padding: 15px 40px;
    font-size: 18px;
    font-family: 'Courier New', monospace;
    background: linear-gradient(135deg, #FFD700, #FFA500);
    color: #000;
    border: 3px solid #FF8C00;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s;
    text-shadow: 1px 1px black;
  }

  .churro-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 0 30px #FFD700;
  }

  .churro-decline-btn {
    position: fixed;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    padding: 15px 40px;
    font-size: 18px;
    font-family: 'Courier New', monospace;
    background: linear-gradient(135deg, #8b5a2b, #5a3a1a);
    color: #f5e6c8;
    border: 3px solid #FFD700;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    z-index: 130;
    transition: all 0.3s;
    text-shadow: 2px 2px black;
  }

  .churro-decline-btn:hover {
    opacity: 0.8;
    transform: scale(1.05);
  }

  /* ===== VIOL√ÉO ===== */
  
  #violao-screen {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 300;
    justify-content: center;
    align-items: center;
    flex-direction: column;
  }
  
  .violao-close-btn {
    position: absolute;
    top: 30px;
    right: 30px;
    background: #FFD700;
    color: #000;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    font-size: 30px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s;
    z-index: 310;
  }
  
  .violao-close-btn:hover {
    background: #FFA500;
    transform: scale(1.1);
  }
  
  .violao-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 40px;
  }
  
  #heitor-violao {
    width: 500px;
    height: 500px;
    object-fit: contain;
    filter: drop-shadow(0 10px 30px rgba(255, 215, 0, 0.5));
    image-rendering: pixelated;
  }
  
  .btn-solta-som {
    padding: 20px 60px;
    font-size: 28px;
    font-family: 'Courier New', monospace;
    background: linear-gradient(135deg, #FFD700, #FFA500);
    color: #000;
    border: 4px solid #FF8C00;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    text-shadow: 2px 2px black;
    transition: all 0.3s;
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
  }
  
  .btn-solta-som:hover:not(:disabled) {
    transform: scale(1.1);
    box-shadow: 0 0 50px rgba(255, 215, 0, 0.8);
  }
  
  .btn-solta-som:active:not(:disabled) {
    transform: scale(0.95);
  }

  .btn-solta-som:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  /* ===== INVENT√ÅRIO ===== */

  #inventory-button {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 25px;
    font-size: 18px;
    font-family: 'Courier New', monospace;
    background: linear-gradient(135deg, #8b5a2b, #5a3a1a);
    color: #f5e6c8;
    border: 3px solid #FFD700;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    z-index: 50;
    transition: all 0.3s;
    text-shadow: 2px 2px black;
    display: none;
  }

  #inventory-button:hover {
    background: linear-gradient(135deg, #FFD700, #FFA500);
    color: #000;
    transform: scale(1.05);
    box-shadow: 0 0 20px #FFD700;
  }

  #inventory-panel {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 500px;
    background: rgba(0, 0, 0, 0.95);
    border: 4px solid #FFD700;
    border-radius: 15px;
    padding: 30px;
    z-index: 200;
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
  }

  #inventory-close {
    position: absolute;
    top: 10px;
    right: 15px;
    background: #FFD700;
    color: #000;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 20px;
    cursor: pointer;
    font-weight: bold;
  }

  #inventory-close:hover {
    background: #FFA500;
  }

  .inventory-title {
    font-size: 24px;
    color: #FFD700;
    text-align: center;
    margin-bottom: 20px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  }

  .inventory-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 10px;
    margin-bottom: 20px;
  }

  .inventory-slot {
    width: 100%;
    aspect-ratio: 1;
    background: rgba(255, 215, 0, 0.1);
    border: 3px solid #FFD700;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
  }

  .inventory-slot:hover {
    background: rgba(255, 215, 0, 0.2);
    box-shadow: 0 0 15px #FFD700;
  }

  .inventory-slot img {
    width: 80%;
    height: 80%;
    object-fit: contain;
  }

  .inventory-slot.empty {
    background: rgba(0, 0, 0, 0.3);
    border-color: #666;
  }

  .inventory-slot.empty:hover {
    background: rgba(0, 0, 0, 0.3);
    box-shadow: none;
  }

  .inventory-description {
    background: rgba(255, 215, 0, 0.1);
    border: 2px solid #FFD700;
    border-radius: 8px;
    padding: 15px;
    color: #ffffff;
    text-align: center;
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    font-size: 14px;
  }

  #inventory-notification {
    display: none;
    position: fixed;
    top: 100px;
    right: 30px;
    background: rgba(0, 0, 0, 0.9);
    color: #FFD700;
    padding: 20px 30px;
    border: 3px solid #FFD700;
    border-radius: 10px;
    z-index: 150;
    font-size: 16px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    animation: slideIn 0.5s ease-out;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(100px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* ===== VISUALIZA√á√ÉO DE ITEM GRANDE ===== */
  
  #item-viewer {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 300;
    justify-content: center;
    align-items: center;
    flex-direction: column;
  }

  .item-viewer-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 30px;
  }

  .item-viewer-image {
    width: 400px;
    height: 400px;
    background: rgba(255, 215, 0, 0.1);
    border: 5px solid #FFD700;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
  }

  .item-viewer-image img {
    width: 90%;
    height: 90%;
    object-fit: contain;
  }

  .item-viewer-description {
    background: rgba(0, 0, 0, 0.8);
    border: 4px solid #FFD700;
    border-radius: 15px;
    padding: 25px 40px;
    color: #ffffff;
    text-align: center;
    max-width: 600px;
    font-size: 18px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    line-height: 1.6;
  }

  .item-viewer-close {
    position: absolute;
    top: 30px;
    right: 30px;
    background: #FFD700;
    color: #000;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    font-size: 30px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s;
  }

  .item-viewer-close:hover {
    background: #FFA500;
    transform: scale(1.1);
  }

  #exit-arrow {
    display: none;
    position: absolute;
    right: 100px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 150px;
    z-index: 30;
    animation: pulse-arrow 1s ease-in-out infinite;
    text-shadow: 0 0 30px #FFD700, 0 0 60px #FF6B00;
    filter: drop-shadow(0 0 10px #FFD700);
  }

  @keyframes pulse-arrow {
    0%, 100% { 
      transform: translateY(-50%) scale(1);
      opacity: 1;
    }
    50% { 
      transform: translateY(-50%) scale(1.2) translateX(30px);
      opacity: 0.7;
    }
  }

  @keyframes popIn {
    0% { opacity: 0; transform: scale(0.5); }
    100% { opacity: 1; transform: scale(1); }
  }

  @keyframes pulse {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.3); }
    100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  }

  @keyframes bounce {
    0%, 100% { transform: translateX(-50%) translateY(0); }
    50% { transform: translateX(-50%) translateY(-20px); }
  }

  @keyframes popMessage {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
    100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  }

  /* ===== MENU REPERT√ìRIO BRUNO ===== */
  #bruno-repertorio-menu {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 700;
    justify-content: center;
    align-items: center;
  }

  .bruno-menu-content {
    background: linear-gradient(135deg, #2c1810, #1a0f0a);
    border: 6px solid #FFD700;
    border-radius: 25px;
    padding: 50px;
    max-width: 700px;
    color: #ffffff;
    text-align: center;
    box-shadow: 0 0 60px rgba(255, 215, 0, 0.6);
    animation: popIn 0.3s ease-out;
  }

  .bruno-menu-content h2 {
    font-size: 38px;
    color: #FFD700;
    margin-top: 0;
    margin-bottom: 15px;
    text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.9);
  }

  .bruno-menu-content .subtitle {
    font-size: 18px;
    color: #f5e6c8;
    margin-bottom: 35px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  }

  .bruno-rimas-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 18px;
    margin-bottom: 30px;
  }

  .bruno-rima-btn {
    padding: 18px 30px;
    font-size: 20px;
    font-family: 'Courier New', monospace;
    background: linear-gradient(135deg, #8b5a2b, #5a3a1a);
    color: #f5e6c8;
    border: 4px solid #FFD700;
    border-radius: 12px;
    cursor: pointer;
    text-shadow: 2px 2px black;
    font-weight: bold;
    transition: all 0.3s;
    text-align: left;
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .bruno-rima-btn:hover {
    background: linear-gradient(135deg, #FFD700, #FFA500);
    color: #000;
    transform: translateX(10px) scale(1.05);
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
  }

  .bruno-rima-btn .icon {
    font-size: 32px;
    min-width: 40px;
  }

  .bruno-menu-close-btn {
    padding: 15px 50px;
    font-size: 20px;
    font-family: 'Courier New', monospace;
    background: linear-gradient(135deg, #ff6b6b, #cc5555);
    color: #fff;
    border: 3px solid #ff4444;
    border-radius: 10px;
    cursor: pointer;
    text-shadow: 2px 2px black;
    font-weight: bold;
    transition: all 0.3s;
  }

  .bruno-menu-close-btn:hover {
    background: linear-gradient(135deg, #ff4444, #aa3333);
    transform: scale(1.05);
    box-shadow: 0 0 25px rgba(255, 68, 68, 0.6);
  }

  /* ===== EFEITO VISUAL DE CANTO ===== */
  #bruno-canto-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(255, 215, 0, 0.3) 0%, rgba(0, 0, 0, 0.7) 100%);
    z-index: 650;
    pointer-events: none;
    animation: pulseGlow 2s ease-in-out infinite;
  }

  @keyframes pulseGlow {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 0.9; }
  }
</style>
</head>
<body>

<!-- MENU PRINCIPAL -->
<div id="menu-screen">
  <div class="menu-container">
    <button class="menu-btn" onclick="iniciarAventura()">üéÆ Come√ßar Aventura</button>
    <button class="menu-btn" onclick="abrirConsideracoes()">üìú Considera√ß√µes</button>
    <button class="menu-btn" onclick="abrirCreditos()">üé¨ Cr√©ditos</button>
    <button class="menu-btn" id="menu-sair" onclick="sairJogo()">‚ùå Sair</button>
  </div>
</div>

<!-- MODAL DE CONSIDERA√á√ïES -->
<div id="consideracoes-modal">
  <div class="modal-content">
    <h2>üíñ Considera√ß√µes üíñ</h2>
    <p>Este jogo trata-se de algo feito para nosso amado Menino Heitor, se lembrar eternamente de todos aqueles que o amam e o quererm bem. Algo simples, mas feito com amor e que ser√° uma memoria afetiva poderosa. Te amamos Heitor, Aproveitem cada momento desse pequeno entretenimento.</p>
    <button class="modal-close-btn" onclick="fecharConsideracoes()">Fechar</button>
  </div>
</div>

<!-- MENU REPERT√ìRIO TIO BRUNO -->
<div id="bruno-repertorio-menu">
  <div class="bruno-menu-content">
    <h2>üé≠ REPERT√ìRIO DO TIO BRUNO üé≠</h2>
    <p class="subtitle">Escolha uma rima para eu cantar!</p>
    <div class="bruno-rimas-grid">
      <button class="bruno-rima-btn" onclick="escolherRepertorioBruno('tina')">
        <span class="icon">üé≠</span>
        <span>Rima da Tina - A Gata Arranhadora</span>
      </button>
      <button class="bruno-rima-btn" onclick="escolherRepertorioBruno('laura')">
        <span class="icon">üë∏</span>
        <span>Rima da Laura - A Princesa das C√≥cegas</span>
      </button>
      <button class="bruno-rima-btn" onclick="escolherRepertorioBruno('churros')">
        <span class="icon">üç™</span>
        <span>Rima dos Churros - O Segredo da V√≥ Didi</span>
      </button>
      <button class="bruno-rima-btn" onclick="escolherRepertorioBruno('violao')">
        <span class="icon">üé∏</span>
        <span>Rima do Viol√£o - O Legado do V√≥ Deco</span>
      </button>
      <button class="bruno-rima-btn" onclick="escolherRepertorioBruno('taberna')">
        <span class="icon">üç∫</span>
        <span>Rima da Taberna - O Caos Divertido</span>
      </button>
    </div>
    <button class="bruno-menu-close-btn" onclick="fecharMenuRepertorioBruno()">Fechar Menu</button>
  </div>
</div>

<!-- OVERLAY VISUAL PARA CANTO -->
<div id="bruno-canto-overlay"></div>

<!-- TELA DO JOGO -->
<div id="game-screen">
  <div id="pokemon-intro">
    <div class="pokemon-container">
      <div class="pokemon-left">
        <img src="heitor.png" id="heitor-intro" alt="Heitor">
        <div class="pokemon-name">HEITOR</div>
      </div>
      <div class="vs-text">VS</div>
      <div class="pokemon-right">
        <img src="laura.png" id="laura-intro" alt="Laura">
        <div class="pokemon-name">LAURA</div>
      </div>
      <button class="duelar-btn" id="duelar-btn">‚ö° DUELAR ‚ö°</button>
    </div>
  </div>

  <div id="jokenpo-interface">
    <div class="jokenpo-result-text" id="jokenpo-result"></div>
    <div class="jokenpo-ui">
      <div class="jokenpo-player-section">
        <div class="jokenpo-player-name">HEITOR</div>
        <div class="jokenpo-lives-display" id="heitor-lives"></div>
        <div class="jokenpo-choice-display" id="heitor-choice-display">?</div>
      </div>

      <div class="jokenpo-buttons-section">
        <button class="jokenpo-btn" id="btn-pedra" onclick="jogarPedra()" title="Pedra">
          <img src="pedra.png" alt="Pedra">
        </button>
        <button class="jokenpo-btn" id="btn-papel" onclick="jogarPapel()" title="Papel">
          <img src="papel.png" alt="Papel">
        </button>
        <button class="jokenpo-btn" id="btn-tesoura" onclick="jogarTesoura()" title="Tesoura">
          <img src="tesoura.png" alt="Tesoura">
        </button>
      </div>

      <div class="jokenpo-player-section">
        <div class="jokenpo-player-name">LAURA</div>
        <div class="jokenpo-lives-display" id="laura-lives"></div>
        <div class="jokenpo-choice-display" id="laura-choice-display">?</div>
      </div>
    </div>
  </div>

  <div id="hud">
    <div class="health-container">HEITOR<div class="health-bar"><div id="heitor-life" class="health-fill"></div></div></div>
    <div class="health-container" id="tina-hud">TINA<div class="health-bar"><div id="tina-life" class="health-fill"></div></div></div>
    <div class="health-container" id="laura-hud" style="display:none;">LAURA<div class="health-bar"><div id="laura-life" class="health-fill"></div></div></div>
  </div>

  <div id="dialog-box">
    <h2 id="dialog-title"></h2>
    <p id="dialog-text"></p>
    <p id="dialog-hint">Pressione [E] para continuar</p>
  </div>

  <div class="intro-container">
    <div class="intro-text" id="text" style="font-size:32px; margin-bottom:25px;">Convidado, prepare-se para a aventura.</div>
    <button class="btn" id="btn" onclick="nextText()">Continuar</button>
  </div>

  <div id="heitor-container">
    <img src="heitor.png" id="heitor" alt="Heitor">
  </div>

  <img src="tina.png" id="tina">
  <img src="luiza.png" id="luiza">
  <img src="laura.png" id="laura">
  <img src="tinatriste.png" id="tinatriste">
  <img src="vodidi.png" id="vodidi">
  <img src="vodeco.png" id="vodeco">
  <img src="tiad.png" id="tiad">
  <img src="tioguigo.png" id="tioguigo">
  <img src="tialine.png" id="tialine">
  <img src="violao.png" id="violao">
  <img src="tiobruno.png" id="tiobruno">
  <img src="vomari.png" id="vomari">

  <!-- CAIXA DE INTERA√á√ÉO COM NPCs -->
  <div id="interaction-prompt">
    üî∂ APERTE [E] PARA INTERAGIR
  </div>

  <!-- MENU DE ESCOLHA (SIM/N√ÉO) -->
  <div id="choice-menu">
    <h3>üç™ V√ì DIDI DIZ üç™</h3>
    <p>Voc√™ DEVE estar cansado de suas viagens! Venha, desfrute de um delicioso churros!!</p>
    <div class="choice-buttons">
      <button class="choice-btn" onclick="escolherChurros('sim')">Hummm, del√≠cia! Quero um!</button>
      <button class="choice-btn" onclick="escolherChurros('nao')">N√£o estou a fim...</button>
    </div>
  </div>

  <!-- MENU DE CHURROS -->
  <div id="churros-menu">
    <div id="churros-menu-content">
      <h1 class="churros-title">üç™ CARD√ÅPIO DE CHURROS üç™</h1>
      
      <div class="churros-container">
        <!-- CHURRO DOCE DE LEITE -->
        <div class="churro-option" onclick="escolherChurro('doce')">
          <div class="churro-image">
            <img src="churrosdoce.png" alt="Churro Doce de Leite">
          </div>
          <div class="churro-info">
            <div class="churro-name">üçØ CHURRO DOCE DE LEITE üçØ</div>
            <p class="churro-description">
              Um churro irresist√≠vel recheado com doce de leite cremoso e envolvido em calda de doce de leite puro. Crocante por fora, derretendo o melhor doce de leite por dentro. Uma verdadeira explos√£o de sabor que vai deixar seu paladar pedindo mais!
            </p>
            <button class="churro-btn">Escolher este üòç</button>
          </div>
        </div>

        <!-- CHURRO NUTELLA -->
        <div class="churro-option" onclick="escolherChurro('nutella')">
          <div class="churro-image">
            <img src="churrosnutella.png" alt="Churro Nutella">
          </div>
          <div class="churro-info">
            <div class="churro-name">üç´ CHURRO NUTELLA üç´</div>
            <p class="churro-description">
              Um espet√°culo de sabor! Churro crocante recheado com Nutella su√≠√ßa pura, derretida na textura perfeita. Finalizado com um toque de calda de chocolate belga e avel√£. Uma experi√™ncia de sabor inigual√°vel que far√° voc√™ voltar sempre!
            </p>
            <button class="churro-btn">Escolher este ü§§</button>
          </div>
        </div>
      </div>
    </div>

    <button class="churro-decline-btn" onclick="recusarChurrosAposMenu()">Mudei de ideia... üòÖ Sair do Menu</button>
  </div>

  <!-- TELA DO VIOL√ÉO -->
  <div id="violao-screen">
    <button class="violao-close-btn" onclick="fecharTelaViolao()">‚úï</button>
    <div class="violao-container">
      <img src="hviolao.png" id="heitor-violao" alt="Heitor com Viol√£o">
      <button class="btn-solta-som" onclick="tocandoViolao()">üé∏ SOLTA O SOM! üé∏</button>
    </div>
  </div>

  <!-- INVENT√ÅRIO -->
  <button id="inventory-button" onclick="abrirInventario()">üì¶ INVENT√ÅRIO [I]</button>

  <div id="inventory-panel">
    <button id="inventory-close" onclick="fecharInventario()">‚úï</button>
    <div class="inventory-title">üì¶ INVENT√ÅRIO</div>
    <div class="inventory-grid" id="inventory-grid"></div>
    <div class="inventory-description" id="inventory-description">Selecione um item para ver a descri√ß√£o</div>
  </div>

  <!-- VISUALIZADOR DE ITEM -->
  <div id="item-viewer">
    <button class="item-viewer-close" onclick="fecharViewerItem()">‚úï</button>
    <div class="item-viewer-container">
      <div class="item-viewer-image" id="item-viewer-image"></div>
      <div class="item-viewer-description" id="item-viewer-description"></div>
    </div>
  </div>

  <div id="inventory-notification"></div>

  <div id="exit-arrow">‚Üí</div>
</div>

<script>
  // FRAMES DE ANIMA√á√ÉO
  const heitorFrames = ["heitor.png", "h1.png", "h2.png", "h3.png", "h4.png", "h5.png"];
  const pingPongSequence = [1, 2, 3, 4, 5, 4, 3, 2];
  let currentFrameIndex = 0;
  let animationTimer = 0;
  const frameDelay = 5;

  // √ÅUDIO - Inicializar sem loop inicialmente
  const somMenu = new Audio('trilhamenu.mp3');
  somMenu.loop = true;
  somMenu.volume = 0.5;

  const somPrincipal = new Audio('trilha_principal.mp3');
  somPrincipal.loop = true;
  somPrincipal.volume = 0.5;

  const somTaberna = new Audio('somtaberna.mp3');
  somTaberna.loop = true;
  somTaberna.volume = 0.9;

  const somBatalha = new Audio('batalha.mp3');
  somBatalha.loop = true;
  somBatalha.volume = 0.6;

  const somjokenpo = new Audio('somjokenpo.mp3');
  somjokenpo.loop = true;
  somjokenpo.volume = 0.1;

  const somcocegas = new Audio('somcocegas.mp3');
  somcocegas.volume = 1.0;

  const somAtaque = new Audio('ataque.mp3');
  const somPulo = new Audio('pulo.mp3');
  const somComer = new Audio('comer.mp3');
  somComer.volume = 0.8;

  const somviolao = new Audio('somviolao.mp3');
  somviolao.volume = 0.8;

  const trilha5 = new Audio('trilha5.mp3');
  trilha5.loop = true;
  trilha5.volume = 1.0;

  // FLAG para controlar se a m√∫sica de menu j√° tocou
  let musicaMenuTocando = false;

  // INICIAR M√öSICA DO MENU - apenas uma vez
  function iniciarMusicaMenu() {
    if (!musicaMenuTocando) {
      musicaMenuTocando = true;
      somMenu.play().catch(e => console.log("M√∫sica do menu ainda n√£o dispon√≠vel"));
      document.removeEventListener('click', iniciarMusicaMenu);
    }
  }
  document.addEventListener('click', iniciarMusicaMenu);

  // VARI√ÅVEIS DE JOGO
  const HEITOR_HEIGHT = 120; // N√ÉO MUDE - Tamanho fixo do Heitor
  const NPC_PROXIMITY_THRESHOLD = 200; // Dist√¢ncia para mostrar prompt de intera√ß√£o
  const INTERACTION_PROMPT_OFFSET = 280; // Offset vertical do prompt de intera√ß√£o
  let stage = 0, gameActive = false, cutsceneActive = false, battleActive = false;
  let level2Active = false, level3Active = false, level4Active = false, level5Active = false;
  let ground = window.innerHeight * 0.40;
  let posX = window.innerWidth * 0.4, posY = -300, velocityX = 0, velocityY = 0;
  let accel = 0.8, friction = 0.85, maxSpeed = 8, gravity = 0.8, jumpForce = 19;
  let direction = 1, isJumping = false, coyoteTime = 0, jumpBuffer = 0;
  let tinaX = window.innerWidth + 100, tinaY = ground, tinaVY = 0, tinaDir = -1;
  let luizaX = -150;
  let lauraX = window.innerWidth + 100, lauraY = ground;
  let vodidiX = window.innerWidth + 100, vodidiY = ground;
  let vodecoDX = window.innerWidth + 100, vodecoDY = ground;
  let tiaDX = window.innerWidth + 100, tiaDY = ground;
  let tioGuigoDX = window.innerWidth + 100, tioGuigoDY = ground;
  let violaoX = 0, violaoY = 0;
  let heitorHP = 5, tinaHP = 10, lauraHP = 8, keys = {};
  let diaperInterval;
  let jokenpoHeitorVitorias = 0, jokenpoLauraVitorias = 0;
  let jokenpoAtivo = false, jokenpoJogado = false, jokenpoEmAndamento = false;
  let dialogWaitingForInput = false;

  // VARI√ÅVEIS V√ì DIDI
  let vodidiInteractionActive = false;
  let vodidiInteractionCompleted = false;
  let churrosEscolhido = null;

  // VARI√ÅVEIS VODECO
  let vodecoDInteractionActive = false;
  let vodecoDInteractionCompleted = false;
  let violaoDesbloqueado = false;
  let telaViolaoAberta = false;
  let violaoRespostaUsuario = '';

  // VARI√ÅVEIS TIA D (TABERNA)
  let tiaDInteractionActive = false;
  let tiaDInteractionCompleted = false;
  let tiaDDialogInicial = false;

  // VARI√ÅVEIS TIO GUIGO
  let tioGuigoInteractionActive = false;
  let tioGuigoInteractionCompleted = false;
  let perfumeOferecido = false;
  let mostrarConfirmacaoAgain = false;

  // VARI√ÅVEIS TIA ALINE
  let tiaAlineX = 0;
  let tiaAlineY = 0;
  let tiaAlineInteractionActive = false;
  let tiaAlineInteractionCompleted = false;
  let tiaAlineSequenceTriggered = false;
  let tiaAlineInteractionAvailable = false;

  // VARI√ÅVEIS LEVEL 6
  let level6Active = false;
  let tiobrunoX = 0;
  let tiobrunoY = 0;
  let tiobrunoInteractionActive = false;
  let tiobrunoInteractionCompleted = false;
  let brunoRepertorioSelecionado = null;
  let vomariX = 0;
  let vomariY = 0;
  let vomariInteractionActive = false;
  let vomariInteractionCompleted = false;

  // VARI√ÅVEL PARA CONTROLAR QUAL NPC EST√Å MAIS PR√ìXIMO
  let proximoNPC = null;

  // VARI√ÅVEIS INVENT√ÅRIO
  let inventoryItems = [null, null, null, null, null, null, null];
  let selectedSlot = -1;
  let inventoryUnlocked = false;
  let canExitLevel3 = false;
  let canExitLevel4 = false;
  let canExitLevel5 = false;
  let exitArrowVisible = false;

  const itemDescriptions = {
    'carta': 'Item que a vov√≥ do churros me deu. Parece usada.',
    'violao': 'Viol√£o que ganhei do vov√≥ m√∫sico! Parece usado.',
    'perfume': 'Um perfume especial que recebi do Tio Guigo na taberna. Cheira muito bem!',
    'pastel': 'Um delicioso pastel de cortesia da taberna!',
    'drink': 'Uma bebida estranha que a Tia Aline fez para mim. Deveria ter aceitado as outras op√ß√µes.',
    'moscowmule': 'Um Moscow Mule delicioso preparado pela Tia Aline!',
    'pinacolada': 'Uma Pi√±a Colada refrescante feita pela Tia Aline!'
  };

  // ========== FUN√á√ïES DO MENU ==========

 function iniciarAventura() {
    const menuScreen = document.getElementById("menu-screen");
    const gameScreen = document.getElementById("game-screen");
    
    menuScreen.style.display = "none";
    gameScreen.style.display = "block";
    
    // Remover folhas do menu
    document.querySelectorAll(".folha").forEach(f => f.remove());
    
    // Parar COMPLETAMENTE a m√∫sica do menu
    somMenu.loop = false;
    somMenu.pause();
    somMenu.currentTime = 0;
    
    // Aguardar um pouco para garantir que parou
    setTimeout(() => {
      somPrincipal.currentTime = 0;
      somPrincipal.play().catch(e => console.log("M√∫sica principal ainda n√£o dispon√≠vel"));
      nextText();
    }, 200);
  }

  function abrirConsideracoes() {
    const modal = document.getElementById("consideracoes-modal");
    modal.style.display = "flex";
  }

  function fecharConsideracoes() {
    const modal = document.getElementById("consideracoes-modal");
    modal.style.display = "none";
  }

  function abrirCreditos() {
    const modal = document.createElement("div");
    modal.id = "creditos-modal";
    modal.style.cssText = `
      display: flex;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 600;
      justify-content: center;
      align-items: center;
    `;
    modal.innerHTML = `
      <div class="modal-content">
        <h2>üé¨ Cr√©ditos üé¨</h2>
        <p><strong>Desenvolvido por:</strong></p>
        <p>üë®‚Äçüíº Papai Rafa</p>
        <p><strong>Com apoio moral:</strong></p>
        <p>üíñ Toda a fam√≠lia</p>
        <button class="modal-close-btn" onclick="document.getElementById('creditos-modal').remove()">Fechar</button>
      </div>
    `;
    document.body.appendChild(modal);
  }

  function sairJogo() {
    if (confirm("Tem certeza que deseja sair do jogo?")) {
      window.close();
    }
  }

  function iniciarAnimacaoFolhas() {
    setInterval(() => {
      const folha = document.createElement("img");
      folha.src = "folha.png";
      folha.classList.add("folha");
      folha.style.left = Math.random() * 100 + "vw";
      folha.style.animationDuration = (8 + Math.random() * 6) + "s";
      document.getElementById("menu-screen").appendChild(folha);
      setTimeout(() => folha.remove(), 15000);
    }, 800);
  }

  iniciarAnimacaoFolhas();

  function typeText(element, text, speed = 80) {
    return new Promise((resolve) => {
      let index = 0;
      element.innerText = "";
      
      function type() {
        if (index < text.length) {
          element.innerText += text.charAt(index);
          index++;
          setTimeout(type, speed);
        } else {
          resolve();
        }
      }
      
      type();
    });
  }

  function showDialog(title, text) {
    return new Promise((resolve) => {
      const box = document.getElementById("dialog-box");
      const titleEl = document.getElementById("dialog-title");
      const textEl = document.getElementById("dialog-text");
      const hintEl = document.getElementById("dialog-hint");
      
      box.style.display = "block";
      
      if (titleEl.innerText !== title) {
        titleEl.innerText = title;
      }
      
      hintEl.style.display = "none";
      dialogWaitingForInput = false;

      typeText(textEl, text, 60).then(() => {
        hintEl.style.display = "block";
        dialogWaitingForInput = true;
        
        const handleInput = (e) => {
          if (e.key.toLowerCase() === 'e' && dialogWaitingForInput) {
            dialogWaitingForInput = false;
            document.removeEventListener("keydown", handleInput);
            
            box.style.display = "none";
            titleEl.innerText = "";
            textEl.innerText = "";
            
            resolve();
          }
        };
        
        document.addEventListener("keydown", handleInput);
      });
    });
  }

  function updateHeitorFrame() {
    const heitorEl = document.getElementById("heitor");
    
    if (Math.abs(velocityX) < 0.1 && gameActive) {
      heitorEl.src = heitorFrames[0];
      currentFrameIndex = 0;
      animationTimer = 0;
      return;
    }
    
    if (Math.abs(velocityX) >= 0.1 || cutsceneActive) {
      animationTimer++;
      if (animationTimer >= frameDelay) {
        animationTimer = 0;
        currentFrameIndex = (currentFrameIndex + 1) % pingPongSequence.length;
        heitorEl.src = heitorFrames[pingPongSequence[currentFrameIndex]];
      }
    } else {
      heitorEl.src = heitorFrames[0];
      currentFrameIndex = 0;
      animationTimer = 0;
    }
  }

  function nextText() {
    const text = document.getElementById("text");
    const btn = document.getElementById("btn");
    const heitorContainer = document.getElementById("heitor-container");
    
    if (stage === 0) {
      text.innerText = "Heitor precisa de voc√™.";
      stage = 1;
      setTimeout(() => { heitorContainer.style.left = "40%"; }, 500);
    } else if (stage === 1) {
      text.innerText = "A jornada come√ßa agora...";
      btn.style.display = "none";
      stage = 2;
      setTimeout(createStartButton, 2000);
    }
  }

  function createStartButton() {
    const container = document.querySelector(".intro-container");
    const newBtn = document.createElement("button");
    newBtn.innerText = "Vamos l√°!";
    newBtn.classList.add("btn");
    container.appendChild(newBtn);
    newBtn.onclick = () => { container.style.display = "none"; showMission(); };
  }

  function showMission() {
    const box = document.getElementById("dialog-box");
    box.style.display = "block";
    document.getElementById("dialog-title").innerText = "‚ö†Ô∏è ATEN√á√ÉO!";
    document.getElementById("dialog-text").innerText = "A Tina est√° querendo arranhar a Princesa Luiza, salve-a!";
    document.getElementById("dialog-hint").style.display = "none";
    
    const startListener = (e) => {
      if (e.key.toLowerCase() === 'e') {
        // Parar m√∫sica principal completamente
        somPrincipal.pause();
        somPrincipal.currentTime = 0;
        
        // Aguardar e come√ßar a m√∫sica de batalha
        setTimeout(() => {
          somBatalha.currentTime = 0;
          somBatalha.play().catch(e => console.log("M√∫sica de batalha ainda n√£o dispon√≠vel"));
          box.style.display = "none";
          document.removeEventListener("keydown", startListener);
          startGame();
        }, 100);
      }
    };
    document.addEventListener("keydown", startListener);
  }

  function startGame() {
    document.getElementById("hud").style.display = "flex";
    document.getElementById("tina-hud").style.display = "block";
    battleActive = true;
    document.getElementById("heitor-container").style.transition = "none";
    document.getElementById("tina").style.display = "block";
    fallFromSky();
  }

    function fallFromSky() {
    function fall() {
      velocityY -= gravity;
      posY += velocityY;
      if (posY <= ground) {
        posY = ground;
        velocityY = 0;
        enableControls();
        gameActive = true;
        gameLoop();
        return;
      }
      requestAnimationFrame(fall);
    }
    velocityY = 0;
    fall();
  }

  function enableControls() {
    document.addEventListener("keydown", e => {
      keys[e.key.toLowerCase()] = true;
      if ((e.code === "Space" || e.key === "w") && !isJumping && gameActive) {
        jumpBuffer = 6;
        somPulo.currentTime = 0;
        somPulo.play().catch(e => console.log("Som de pulo n√£o dispon√≠vel"));
      }
    });
    document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);
    document.addEventListener("mousedown", e => { if (e.button === 0 && gameActive && battleActive) attack(); });
  }

  function attack() {
    somAtaque.currentTime = 0;
    somAtaque.play().catch(e => console.log("Som de ataque n√£o dispon√≠vel"));

    const effect = document.createElement("div");
    effect.innerText = "üí•";
    effect.style.cssText = `position:absolute; z-index:5; font-size:100px; left:${posX + (direction * 110)}px; bottom:${posY + 50}px;`;
    document.body.appendChild(effect);
    setTimeout(() => effect.remove(), 200);

    let dist = Math.abs((posX + (direction * 90)) - tinaX);
    if (dist < 110 && Math.abs(posY - tinaY) < 110) {
      tinaHP--;
      updateHUD();
      document.getElementById("tina").classList.add("hit-flash");
      setTimeout(() => document.getElementById("tina").classList.remove("hit-flash"), 150);
      if (tinaHP <= 0) startVictoryCutscene();
    }
  }

  function updateHUD() {
    document.getElementById("heitor-life").style.width = Math.max(0, heitorHP * 20) + "%";
    document.getElementById("tina-life").style.width = Math.max(0, tinaHP * 10) + "%";
    document.getElementById("laura-life").style.width = Math.max(0, lauraHP * 12.5) + "%";
  }

  function startVictoryCutscene() {
    gameActive = false;
    battleActive = false;
    document.getElementById("hud").style.display = "none";
    somBatalha.pause();
    somBatalha.currentTime = 0;
    
    setTimeout(() => {
      somPrincipal.currentTime = 0;
      somPrincipal.play().catch(e => console.log("M√∫sica principal n√£o dispon√≠vel"));
    }, 100);

    const tina = document.getElementById("tina");
    tina.style.transition = "all 1s ease-in";
    tina.style.left = (window.innerWidth + 500) + "px";
    tina.style.bottom = "800px";
    tina.style.transform = "rotate(720deg)";

    setTimeout(() => {
      const luiza = document.getElementById("luiza");
      luiza.style.display = "block";
      animateLuiza();
    }, 1000);
  }

  function animateLuiza() {
    if (luizaX < posX - 130) {
      luizaX += 1.5;
      const lEl = document.getElementById("luiza");
      lEl.style.left = luizaX + "px";
      lEl.style.bottom = ground + "px";
      lEl.style.transform = "scaleX(-1)";
      requestAnimationFrame(animateLuiza);
    } else {
      showFinalDialog();
    }
  }

  async function showFinalDialog() {
    direction = -1;
    updateVisuals();
    await showDialog("PRINCESA LUIZA DIZ:", "Heitor! Obrigado por me salvar. Agora precisam de voc√™ em outro lugar. V√°! Corra!");
    luizaEscape();
  }

  function luizaEscape() {
    document.getElementById("luiza").style.transition = "all 1s ease-in";
    document.getElementById("luiza").style.left = "-200px";
    setTimeout(() => heitorEscape(), 1000);
  }

  function heitorEscape() {
    clearInterval(diaperInterval);
    document.querySelectorAll(".diaper").forEach(d => d.remove());
    document.getElementById("tina").style.display = "none";
    document.getElementById("luiza").style.display = "none";
    battleActive = false;
    gameActive = false;
    cutsceneActive = true;
    direction = 1;

    const run = () => {
      posX += 12;
      updateVisuals();
      if (posX < window.innerWidth + 200) {
        requestAnimationFrame(run);
      } else {
        document.getElementById("heitor-container").style.display = "none";
        cutsceneActive = false;
        iniciarTransicao();
      }
    };
    run();
  }

  function iniciarTransicao() {
    gameActive = false;
    const gameScreen = document.getElementById("game-screen");
    gameScreen.style.background = "#000000";
    setTimeout(() => {
      gameScreen.style.background = '#87CEEB url("background_1.png") no-repeat bottom center';
      gameScreen.style.backgroundSize = "cover";
      posX = -150;
      posY = ground;
      velocityX = 0;
      velocityY = 0;

      setTimeout(() => {
        const heitorContainer = document.getElementById("heitor-container");
        heitorContainer.style.display = "block";
        heitorContainer.style.transition = "none";
        updateVisuals();

        cutsceneActive = true;
        const enterGame = () => {
          posX += 5;
          updateVisuals();
          if (posX < window.innerWidth * 0.4) {
            requestAnimationFrame(enterGame);
          } else {
            cutsceneActive = false;
            setTimeout(() => {
              level2Active = true;
              gameActive = true;
              gameLoop();
              showLevel2Intro();
            }, 300);
          }
        };
        enterGame();
      }, 800);
    }, 300);
  }

  async function showLevel2Intro() {
    const box = document.getElementById("dialog-box");
    box.style.display = "block";
    document.getElementById("dialog-title").innerText = "üèûÔ∏è NOVA √ÅREA";
    document.getElementById("dialog-text").innerText = "Heitor avan√ßou! Mas sua aventura n√£o termina aqui...";
    document.getElementById("dialog-hint").style.display = "none";
    
    dialogWaitingForInput = true;
    await new Promise((resolve) => {
      const handleInput = (e) => {
        if (e.key.toLowerCase() === 'e' && dialogWaitingForInput) {
          dialogWaitingForInput = false;
          document.removeEventListener("keydown", handleInput);
          box.style.display = "none";
          resolve();
        }
      };
      document.addEventListener("keydown", handleInput);
    });
    
    appearLauraAndTinaTriste();
  }

  function appearLauraAndTinaTriste() {
    gameActive = false;
    const laura = document.getElementById("laura");
    const tinatriste = document.getElementById("tinatriste");
    laura.style.display = "block";
    tinatriste.style.display = "block";
    
    lauraX = window.innerWidth + 100;
    lauraY = ground;
    let tinasX = window.innerWidth + 300;
    
    const animarEntrada = () => {
      lauraX -= 4;
      tinasX -= 4;
      laura.style.left = lauraX + "px";
      laura.style.bottom = ground + "px";
      laura.style.transform = "scaleX(-1)";
      tinatriste.style.left = tinasX + "px";
      tinatriste.style.bottom = ground + "px";
      tinatriste.style.transform = "scaleX(-1)";
      
      if (lauraX > posX + 150) {
        requestAnimationFrame(animarEntrada);
      } else {
        showLauraFirstDialog();
      }
    };
    animarEntrada();
  }

  async function showLauraFirstDialog() {
    await showDialog("LAURA DIZ:", "Como ousa bater na minha GATA!!! Voc√™ sofrer√°.");
    showLauraSecondDialog();
  }

  async function showLauraSecondDialog() {
    await showDialog("LAURA DIZ:", "Vou fazer cocegas em voc√™. VAMOS DUELAR!!");
    showPokemonIntro();
  }

  function showPokemonIntro() {
    const intro = document.getElementById("pokemon-intro");
    intro.style.display = "flex";
    document.getElementById("laura-intro").style.transform = "scaleX(-1)";
    document.getElementById("duelar-btn").onclick = () => {
      intro.style.display = "none";
      iniciarJokenpo();
    };
  }

  function iniciarJokenpo() {
    jokenpoEmAndamento = true;
    gameActive = false;
    level2Active = false;
    document.getElementById("jokenpo-interface").style.display = "block";
    jokenpoHeitorVitorias = 0;
    jokenpoLauraVitorias = 0;
    jokenpoAtivo = true;
    
    somPrincipal.pause();
    somPrincipal.currentTime = 0;
    somjokenpo.currentTime = 0;
    somjokenpo.play().catch(e => console.log("Som jokenpo n√£o dispon√≠vel"));
    
    posX = window.innerWidth * 0.2;
    lauraX = window.innerWidth * 0.7;
    updateVisuals();
    document.getElementById("laura").style.left = lauraX + "px";
    document.getElementById("laura").style.transform = "scaleX(-1)";
    atualizarVidasJokenpo();
  }

  function atualizarVidasJokenpo() {
    const heitorLives = document.getElementById("heitor-lives");
    const lauraLives = document.getElementById("laura-lives");
    heitorLives.innerHTML = "";
    lauraLives.innerHTML = "";

    for (let i = 0; i < 3; i++) {
      const h = document.createElement("div");
      h.className = "life-indicator" + (i < jokenpoHeitorVitorias ? " won" : "");
      heitorLives.appendChild(h);

      const l = document.createElement("div");
      l.className = "life-indicator" + (i < jokenpoLauraVitorias ? " won" : "");
      lauraLives.appendChild(l);
    }
  }

  function jogar(escolha) {
    if (jokenpoJogado || !jokenpoAtivo) return;
    jokenpoJogado = true;
    desabilitarBotoes();

    const escolhas = ['pedra', 'papel', 'tesoura'];
    const escolhaLaura = escolhas[Math.floor(Math.random() * 3)];
    const imagensPaths = { pedra: 'pedra.png', papel: 'papel.png', tesoura: 'tesoura.png' };

    const heitorDisplay = document.getElementById("heitor-choice-display");
    heitorDisplay.innerHTML = `<img src="${imagensPaths[escolha]}" alt="${escolha}">`;
    heitorDisplay.classList.add("selected");
    setTimeout(() => {
      const lauraDisplay = document.getElementById("laura-choice-display");
      lauraDisplay.innerHTML = `<img src="${imagensPaths[escolhaLaura]}" alt="${escolhaLaura}">`;
      lauraDisplay.classList.add("selected");
      setTimeout(() => determinarVencedor(escolha, escolhaLaura), 800);
    }, 600);
  }

  function jogarPedra() { jogar('pedra'); }
  function jogarPapel() { jogar('papel'); }
  function jogarTesoura() { jogar('tesoura'); }

  function determinarVencedor(h, l) {
    const resultsDiv = document.getElementById("jokenpo-result");

    if (h === l) {
      resultsDiv.textContent = "EMPATE! Joguem novamente!";
      setTimeout(() => {
        limparJokenpo();
        jokenpoJogado = false;
        habilitarBotoes();
      }, 2000);
      return;
    }

    if ((h === 'pedra' && l === 'tesoura') ||
        (h === 'papel' && l === 'pedra') ||
        (h === 'tesoura' && l === 'papel')) {
      jokenpoHeitorVitorias++;
      resultsDiv.textContent = "HEITOR VENCE! üéâ";
      somcocegas.currentTime = 0;
      somcocegas.play().catch(e => console.log("Som cocegas n√£o dispon√≠vel"));
      aplicarCocegasLaura();
    } else {
      jokenpoLauraVitorias++;
      resultsDiv.textContent = "LAURA VENCE! üí™";
      somcocegas.currentTime = 0;
      somcocegas.play().catch(e => console.log("Som cocegas n√£o dispon√≠vel"));
      aplicarCocegasHeitor();
    }

    atualizarVidasJokenpo();

    setTimeout(() => {
      if (jokenpoHeitorVitorias === 3) {
        finalizarJokenpo("HEITOR");
      } else if (jokenpoLauraVitorias === 3) {
        finalizarJokenpo("LAURA");
      } else {
        limparJokenpo();
        jokenpoJogado = false;
        habilitarBotoes();
      }
    }, 2000);
  }

  function aplicarCocegasHeitor() {
    const heitorEl = document.getElementById("heitor");
    heitorEl.classList.add("shake-animation");
    setTimeout(() => {
      heitorEl.classList.remove("shake-animation");
    }, 2500);
  }

  function aplicarCocegasLaura() {
    const lauraEl = document.getElementById("laura");
    lauraEl.classList.add("shake-animation");
    setTimeout(() => {
      lauraEl.classList.remove("shake-animation");
    }, 2500);
  }

  function limparJokenpo() {
    document.getElementById("heitor-choice-display").innerHTML = "?";
    document.getElementById("heitor-choice-display").classList.remove("selected");
    document.getElementById("laura-choice-display").innerHTML = "?";
    document.getElementById("laura-choice-display").classList.remove("selected");
    document.getElementById("jokenpo-result").textContent = "";
  }

  function desabilitarBotoes() {
    document.getElementById("btn-pedra").disabled = true;
    document.getElementById("btn-papel").disabled = true;
    document.getElementById("btn-tesoura").disabled = true;
  }

  function habilitarBotoes() {
    document.getElementById("btn-pedra").disabled = false;
    document.getElementById("btn-papel").disabled = false;
    document.getElementById("btn-tesoura").disabled = false;
  }

  function finalizarJokenpo(vencedor) {
    document.getElementById("jokenpo-result").textContent = vencedor + " VENCE A BATALHA!";
    desabilitarBotoes();
    jokenpoAtivo = false;

    setTimeout(() => {
      somjokenpo.pause();
      somjokenpo.currentTime = 0;
      document.getElementById("jokenpo-interface").style.display = "none";
      jokenpoEmAndamento = false;
      
      somPrincipal.currentTime = 0;
      somPrincipal.play().catch(e => console.log("M√∫sica principal n√£o dispon√≠vel"));
      
      if (vencedor === "HEITOR") {
        showHeitorVictoryScreen();
      } else if (vencedor === "LAURA") {
        showLauraVictoryScreen();
      }
    }, 3000);
  }

  async function showHeitorVictoryScreen() {
    await showDialog("LAURA DIZ:", "Voc√™ teve sorte! Te deixo passar.");
    showLauraFinalDialog();
  }

  async function showLauraVictoryScreen() {
    await showDialog("LAURA DIZ:", "HA HA HA! Ganhei!");
    showLauraFinalDialog();
  }

  async function showLauraFinalDialog() {
    await showDialog("LAURA DIZ:", "Passe Heitor, LUIZA! VEM AQUI!!");
    lauraAndTinaSaidaCena();
  }

  function lauraAndTinaSaidaCena() {
    gameActive = false;
    cutsceneActive = true;
    level2Active = false;

    const laura = document.getElementById("laura");
    const tinatriste = document.getElementById("tinatriste");

    laura.style.transition = "all 1.5s ease-in";
    tinatriste.style.transition = "all 1.5s ease-in";

    laura.style.left = "-300px";
    tinatriste.style.left = "-300px";

    setTimeout(() => {
      laura.style.display = "none";
      tinatriste.style.display = "none";
      heitorSaidaCenaLevel2();
    }, 1500);
  }

  function heitorSaidaCenaLevel2() {
    direction = 1;
    updateVisuals();

    const run = () => {
      posX += 12;
      updateVisuals();

      if (posX < window.innerWidth + 200) {
        requestAnimationFrame(run);
      } else {
        document.getElementById("heitor-container").style.display = "none";
        cutsceneActive = false;
        iniciarTransicaoLevel3();
      }
    };

    run();
  }

  function iniciarTransicaoLevel3() {
    gameActive = false;
    cutsceneActive = true;
    battleActive = false;
    level2Active = false;

    const gameScreen = document.getElementById("game-screen");
    gameScreen.style.transition = "none";
    gameScreen.style.background = "#000000";

    setTimeout(() => {
      gameScreen.style.transition = "background 1.5s ease-in-out";
      gameScreen.style.background = '#87CEEB url("background_2.png") no-repeat bottom center';
      gameScreen.style.backgroundSize = "cover";

      ground = window.innerHeight * 0.40;
      posY = ground;
      posX = -150;
      velocityX = 0;
      velocityY = 0;
      direction = 1;
      isJumping = false;
      coyoteTime = 0;
      jumpBuffer = 0;

      setTimeout(() => {
        const heitorContainer = document.getElementById("heitor-container");
        heitorContainer.style.display = "block";
        heitorContainer.style.transition = "none";
        heitorContainer.style.opacity = "1";
        updateVisuals();

        cutsceneActive = true;
        const enterGame = () => {
          posX += 5;
          updateVisuals();
          
          if (posX < window.innerWidth * 0.4) {
            requestAnimationFrame(enterGame);
          } else {
            cutsceneActive = false;
            setTimeout(() => {
              gameScreen.style.transition = "none";
              level3Active = true;
              gameActive = false;
              appearVodidi();
            }, 300);
          }
        };

        enterGame();

      }, 800);

    }, 300);
  }

  function appearVodidi() {
    const vodidi = document.getElementById("vodidi");
    
    vodidi.style.display = "block";
    
    vodidiX = window.innerWidth + 100;
    vodidiY = ground - 140;
    
    const animarEntrada = () => {
      vodidiX -= 4;
      
      vodidi.style.left = vodidiX + "px";
      vodidi.style.bottom = vodidiY + "px";
      vodidi.style.transform = "scaleX(1)";
      
      if (vodidiX > posX + 250) {
        requestAnimationFrame(animarEntrada);
      } else {
        vodidiX = posX + 250;
        
        vodidi.style.left = vodidiX + "px";
        vodidi.style.bottom = vodidiY + "px";
        vodidi.style.transform = "scaleX(1)";
        
        showVodidiDialog();
      }
    };
    animarEntrada();
  }

  async function showVodidiDialog() {
    await showDialog("VOV√ì DIDI DIZ:", "Ol√°, nobre guerreiro! Aproxime-se.");
    gameActive = true;
    gameLoop();
  }

  function updateVisuals() {
    const hContainer = document.getElementById("heitor-container");
    hContainer.style.left = posX + "px";
    hContainer.style.bottom = posY + "px";
    hContainer.style.transform = `scaleX(${-direction})`;
    updateHeitorFrame();
  }

  function gameLoop() {
    if (!gameActive) return;
    
    if (level3Active && !vodidiInteractionActive && !vodidiInteractionCompleted) {
      verificarProximidadeVodidi();
    }

    if (level4Active && !vodecoDInteractionActive && !vodecoDInteractionCompleted) {
      verificarProximidadeVodeco();
    }

    if (level5Active && !tiaDDialogInicial && !tiaDInteractionCompleted) {
      verificarProximidadeTiaDInicial();
    }

    // VERIFICAR AMBOS OS NPCs EM PARALELO QUANDO DISPON√çVEIS PARA INTERA√á√ÉO
    if (level5Active && tiaDInteractionCompleted && !tiaDInteractionActive && !tioGuigoInteractionActive) {
      verificarProximidadeTiaDInteracao();
      if (!tioGuigoInteractionCompleted) {
        verificarProximidadeTioGuigo();
      }
    }
    
    // VERIFICAR PROXIMIDADE DE TIA ALINE AP√ìS A SEQU√äNCIA
    if (level5Active && tiaAlineInteractionAvailable && !tiaAlineInteractionActive) {
      verificarProximidadeTiaAline();
    }
    
    if (level3Active && exitArrowVisible) {
      verificarSaidaLevel3();
    }

    if (level4Active && exitArrowVisible) {
      verificarSaidaLevel4();
    }

    if (level5Active) {
      verificarSaidaLevel5();
    }

    if (level6Active && !tiobrunoInteractionActive && !tiobrunoInteractionCompleted) {
      verificarProximidadeTioBruno();
    }

    if (level6Active && !vomariInteractionActive && !vomariInteractionCompleted) {
      verificarProximidadeVomari();
    }

    if (level6Active) {
      verificarSaidaLevel6();
    }
    
    if ((battleActive && !level2Active) || level2Active || level3Active || level4Active || level5Active || level6Active) {
      if (keys["a"] || keys["A"]) { 
        velocityX -= accel; 
        direction = -1; 
      }
      else if (keys["d"] || keys["D"]) { 
        velocityX += accel; 
        direction = 1; 
      }
      else { 
        velocityX *= friction; 
      }
      
      velocityX = Math.max(-maxSpeed, Math.min(maxSpeed, velocityX));
      posX += velocityX;
      if (posX < 0) posX = 0;
      if (posX > window.innerWidth - 100) posX = window.innerWidth - 100;
      
      if (posY <= ground) { coyoteTime = 8; isJumping = false; }
      else { coyoteTime--; }
      if (jumpBuffer > 0 && coyoteTime > 0) { velocityY = jumpForce; isJumping = true; jumpBuffer = 0; coyoteTime = 0; }
      if (jumpBuffer > 0) jumpBuffer--;
      velocityY -= gravity;
      posY += velocityY;
      if (posY <= ground) { posY = ground; velocityY = 0; }
      
      updateVisuals();
    }
    
    if (battleActive && !level2Active) {
      tinaX += (tinaX < posX) ? 3.8 : -3.8;
      tinaX = Math.max(0, Math.min(tinaX, window.innerWidth - 100));
      
      if (Math.random() < 0.015 && tinaY <= ground) tinaVY = 15;
      tinaVY -= gravity;
      tinaY += tinaVY;
      if (tinaY <= ground) { tinaY = ground; tinaVY = 0; }
      
      if (Math.abs(posX - tinaX) < 60 && Math.abs(posY - tinaY) < 60) {
        heitorHP -= 0.015;
        updateHUD();
        if (heitorHP <= 0) {
          gameActive = false;
          battleActive = false;
        }
      }
      
      const tEl = document.getElementById("tina");
      tEl.style.left = tinaX + "px";
      tEl.style.bottom = tinaY + "px";
      tEl.style.transform = `scaleX(${tinaX < posX ? -1 : 1})`;
    }

    // Z-INDEX DIN√ÇMICO - TODOS OS N√çVEIS
    if (level3Active) {
      const vodidi = document.getElementById('vodidi');
      const heitorContainer = document.getElementById('heitor-container');
      if (posY > ground - 10) {
        heitorContainer.style.zIndex = 1;
      } else {
        heitorContainer.style.zIndex = 5;
      }
    }

    if (level4Active) {
      const heitorContainer = document.getElementById('heitor-container');
      if (posY > ground - 10) {
        heitorContainer.style.zIndex = 1;
      } else {
        heitorContainer.style.zIndex = 5;
      }
    }

    if (level5Active) {
      const heitorContainer = document.getElementById('heitor-container');
      if (posY > ground - 10) {
        heitorContainer.style.zIndex = 1;
      } else {
        heitorContainer.style.zIndex = 5;
      }
    }

    // Z-INDEX DIN√ÇMICO - LEVEL 5 (TIA D E TIO GUIGO)
    if (level5Active) {
      const tiad = document.getElementById("tiad");
      const tioguigo = document.getElementById("tioguigo");
      tiad.style.zIndex = posX > tiaDX ? 4 : 2;
      tioguigo.style.zIndex = posX > tioGuigoDX ? 4 : 2;
    }

    // Z-INDEX DIN√ÇMICO - LEVEL 6 (TIO BRUNO E VOMARI)
    if (level6Active) {
      const heitorContainer = document.getElementById('heitor-container');
      const tiobruno = document.getElementById("tiobruno");
      const vomari = document.getElementById("vomari");
      if (posY > ground - 10) {
        heitorContainer.style.zIndex = 1;
      } else {
        heitorContainer.style.zIndex = 5;
      }
      tiobruno.style.zIndex = posX > tiobrunoX ? 4 : 2;
      vomari.style.zIndex = posX > vomariX ? 4 : 2;
    }
    
    requestAnimationFrame(gameLoop);
  }

  diaperInterval = setInterval(() => {
    if (battleActive) {
      const d = document.createElement("img");
      d.src = "fralda.png";
      d.classList.add("diaper");
      d.style.left = Math.random() * 100 + "vw";
      d.style.animationDuration = (3 + Math.random() * 4) + "s";
      document.getElementById("game-screen").appendChild(d);
      setTimeout(() => d.remove(), 7000);
    }
  }, 600);

  function verificarProximidadeVodidi() {
    const distancia = Math.abs(posX - vodidiX);
    const prompt = document.getElementById("interaction-prompt");
    
    if (vodidiInteractionCompleted) {
      prompt.style.display = "none";
      return;
    }
    
    if (distancia < 200) {
      prompt.style.display = "block";
      prompt.style.left = (vodidiX - 120) + "px";
      prompt.style.bottom = (vodidiY + 250) + "px";
    } else {
      prompt.style.display = "none";
    }
  }

  function iniciarInteracaoVodidi() {
    if (!level3Active || vodidiInteractionActive || vodidiInteractionCompleted) return;
    
    const distancia = Math.abs(posX - vodidiX);
    if (distancia < 200) {
      vodidiInteractionActive = true;
      gameActive = false;
      document.getElementById("interaction-prompt").style.display = "none";
      document.getElementById("choice-menu").style.display = "block";
    }
  }

  function escolherChurros(opcao) {
    const choiceMenu = document.getElementById("choice-menu");
    choiceMenu.style.display = "none";
    
    if (opcao === 'sim') {
      setTimeout(() => {
        showDialog("V√ì DIDI DIZ:", "Que √≥timo! Olhe o card√°pio.").then(() => {
          document.getElementById("churros-menu").style.display = "flex";
        });
      }, 300);
    } else if (opcao === 'nao') {
      setTimeout(() => {
        showDialog("V√ì DIDI DIZ:", "Hummm... voc√™ tem certeza?").then(() => {
          mostrarConfirmacaoChurros();
        });
      }, 300);
    }
  }

  function mostrarConfirmacaoChurros() {
    const choiceMenu = document.getElementById("choice-menu");
    const p = choiceMenu.querySelector("p");
    
    p.innerText = "Tem certeza de que n√£o quer?";
    choiceMenu.style.display = "block";
    
    const buttonsDiv = choiceMenu.querySelector(".choice-buttons");
    buttonsDiv.innerHTML = "";
    
    const btn1 = document.createElement("button");
    btn1.className = "choice-btn";
    btn1.innerText = "Pensando bem... Quero um!";
    btn1.onclick = () => {
      choiceMenu.style.display = "none";
      setTimeout(() => {
        showDialog("V√ì DIDI DIZ:", "Que √≥timo! Olhe o card√°pio.").then(() => {
          document.getElementById("churros-menu").style.display = "flex";
        });
      }, 300);
    };
    
    const btn2 = document.createElement("button");
    btn2.className = "choice-btn";
    btn2.innerText = "Sim, tenho certeza!";
    btn2.onclick = () => {
      choiceMenu.style.display = "none";
      setTimeout(() => {
        showDialog("V√ì DIDI DIZ:", "Pelo amor da Quit√°! Que pena.").then(() => {
          finalizarChurrosEvent();
        });
      }, 300);
    };
    
    buttonsDiv.appendChild(btn1);
    buttonsDiv.appendChild(btn2);
  }

  function escolherChurro(tipo) {
    document.getElementById("churros-menu").style.display = "none";
    churrosEscolhido = tipo;
    
    somComer.currentTime = 0;
    somComer.play().catch(e => console.log("Som comer n√£o dispon√≠vel"));
    
    if (tipo === 'doce') {
      setTimeout(() => {
        showDialog("HEITOR COMEU:", "Ahhh, que del√≠cia! Este doce de leite √© simplesmente perfeito! üòç").then(() => {
          finalizarChurrosEvent();
        });
      }, 300);
    } else if (tipo === 'nutella') {
      setTimeout(() => {
        showDialog("HEITOR COMEU:", "Meu Deus! Este churro de Nutella √© SENSACIONAL! Que sabor indescrit√≠vel! ü§§").then(() => {
          finalizarChurrosEvent();
        });
      }, 300);
    }
  }

  function recusarChurrosAposMenu() {
    document.getElementById("churros-menu").style.display = "none";
    setTimeout(() => {
      showDialog("HEITOR DISSE:", "Vou recusar... desculpa, V√≥ Didi!").then(() => {
        finalizarChurrosEvent();
      });
    }, 300);
  }

  function finalizarChurrosEvent() {
    vodidiInteractionActive = false;
    vodidiInteractionCompleted = true;
    document.getElementById("interaction-prompt").style.display = "none";
    exitArrowVisible = true;
    document.getElementById("exit-arrow").style.display = "block";
    gameActive = true;
    gameLoop();
  }

  function verificarSaidaLevel3() {
    if (!canExitLevel3) {
      if (posX > window.innerWidth - 200) {
        gameActive = false;
        document.getElementById("exit-arrow").style.display = "none";
        mostrarChamadaVodidi();
      }
    } else {
      if (posX >= window.innerWidth - 100) {
        iniciarTransicaoLevel4();
      }
    }
  }

  function mostrarChamadaVodidi() {
    const choiceMenu = document.getElementById("choice-menu");
    const h3 = choiceMenu.querySelector("h3");
    const p = choiceMenu.querySelector("p");
    
    h3.innerText = "üéÅ V√ì DIDI DIZ üéÅ";
    p.innerText = "ESPERE! [Aperte E]";
    choiceMenu.style.display = "block";
    
    const buttonsDiv = choiceMenu.querySelector(".choice-buttons");
    buttonsDiv.innerHTML = "";
    
    let waitingForE = false;
    
    const handleKeyPress = (e) => {
      if (e.key.toLowerCase() === 'e' && !waitingForE) {
        waitingForE = true;
        document.removeEventListener("keydown", handleKeyPress);
        choiceMenu.style.display = "none";
        receberCarta();
      }
    };
    
    document.addEventListener("keydown", handleKeyPress);
  }

  function receberCarta() {
    setTimeout(() => {
      showDialog("V√ì DIDI DIZ:", "TOME PARA VOC√ä ISTO, EU GOSTEI MUITO DE VOC√ä JOVEM, LEMBRA MEU NETO.").then(() => {
        inventoryItems[0] = 'carta';
        inventoryUnlocked = true;
        canExitLevel3 = true;
        
        mostrarNotificacaoInventario();
        
        setTimeout(() => {
          document.getElementById("exit-arrow").style.display = "block";
          gameActive = true;
          gameLoop();
        }, 2000);
      });
    }, 300);
  }

  function mostrarNotificacaoInventario() {
    const notification = document.getElementById("inventory-notification");
    notification.innerHTML = "‚ú® INVENT√ÅRIO DESBLOQUEADO! Pressione [I] para abrir";
    notification.style.display = "block";
    
    document.getElementById("inventory-button").style.display = "block";
    
    setTimeout(() => {
      notification.style.display = "none";
    }, 5000);
  }

  function iniciarTransicaoLevel4() {
    gameActive = false;
    cutsceneActive = true;
    level3Active = false;
    
    document.getElementById("vodidi").style.display = "none";
    document.getElementById("exit-arrow").style.display = "none";
    document.getElementById("interaction-prompt").style.display = "none";
    
    const gameScreen = document.getElementById("game-screen");
    gameScreen.style.transition = "none";
    gameScreen.style.background = "#000000";

    setTimeout(() => {
      gameScreen.style.transition = "background 1.5s ease-in-out";
      gameScreen.style.background = '#87CEEB url("background_3.png") no-repeat bottom center';
      gameScreen.style.backgroundSize = "cover";

      ground = window.innerHeight * 0.40;
      posY = ground + 30;
      posX = -150;
      velocityX = 0;
      velocityY = 0;
      direction = 1;
      isJumping = false;
      coyoteTime = 0;
      jumpBuffer = 0;

      setTimeout(() => {
        const heitorContainer = document.getElementById("heitor-container");
        heitorContainer.style.display = "block";
        heitorContainer.style.transition = "none";
        updateVisuals();

        cutsceneActive = true;
        const enterGame = () => {
          posX += 5;
          updateVisuals();
          
          if (posX < window.innerWidth * 0.4) {
            requestAnimationFrame(enterGame);
          } else {
            cutsceneActive = false;
            setTimeout(() => {
              gameScreen.style.transition = "none";
              level4Active = true;
              gameActive = true;
              appearVodeco();
              gameLoop();
            }, 300);
          }
        };

        enterGame();

      }, 800);

    }, 300);
  }

  function appearVodeco() {
    const vodeco = document.getElementById("vodeco");
    const violao = document.getElementById("violao");
    
    vodeco.style.display = "block";
    violao.style.display = "block";
    
    vodecoDX = posX + 350;
    vodecoDY = ground - 140;
    violaoX = vodecoDX + 55;
    violaoY = vodecoDY + 50;
    
    vodeco.style.left = vodecoDX + "px";
    vodeco.style.bottom = vodecoDY + "px";
    vodeco.style.transform = "scaleX(1)";
    
    violao.style.left = violaoX + "px";
    violao.style.bottom = violaoY + "px";
  }

  function verificarProximidadeVodeco() {
    const distancia = Math.abs(posX - vodecoDX);
    const prompt = document.getElementById("interaction-prompt");
    
    if (vodecoDInteractionCompleted) {
      prompt.style.display = "none";
      return;
    }
    
    if (distancia < 200) {
      prompt.style.display = "block";
      prompt.style.left = (vodecoDX - 120) + "px";
      prompt.style.bottom = (vodecoDY + 250) + "px";
    } else {
      prompt.style.display = "none";
    }
  }

  function iniciarInteracaoVodeco() {
    if (!level4Active || vodecoDInteractionActive || vodecoDInteractionCompleted) return;
    
    const distancia = Math.abs(posX - vodecoDX);
    if (distancia < 200) {
      vodecoDInteractionActive = true;
      gameActive = false;
      document.getElementById("interaction-prompt").style.display = "none";
      
      showDialog("V√ì DECO DIZ:", "Ol√° jovem guerreiro! Tudo bem?").then(() => {
        showDialog("V√ì DECO DIZ:", "Somos nobres andarilhos e adoramos m√∫sica! Voc√™ sabe tocar?").then(() => {
          mostrarOpcoesMusicaVodeco();
        });
      });
    }
  }

  function mostrarOpcoesMusicaVodeco() {
    const choiceMenu = document.getElementById("choice-menu");
    const h3 = choiceMenu.querySelector("h3");
    const p = choiceMenu.querySelector("p");
    
    h3.innerText = "üé∏ V√ì DECO PERGUNTA üé∏";
    p.innerText = "Voc√™ sabe tocar?";
    choiceMenu.style.display = "block";
    
    const buttonsDiv = choiceMenu.querySelector(".choice-buttons");
    buttonsDiv.innerHTML = "";
    
    const btn1 = document.createElement("button");
    btn1.className = "choice-btn";
    btn1.innerText = "Sim! Claro!";
    btn1.onclick = () => pegarViolao('sim');
    
    const btn2 = document.createElement("button");
    btn2.className = "choice-btn";
    btn2.innerText = "N√£o, desculpa...";
    btn2.onclick = () => pegarViolao('nao');
    
    buttonsDiv.appendChild(btn1);
    buttonsDiv.appendChild(btn2);
  }

  function pegarViolao(resposta) {
    const choiceMenu = document.getElementById("choice-menu");
    choiceMenu.style.display = "none";
    violaoRespostaUsuario = resposta;
    
    if (resposta === 'sim') {
      setTimeout(() => {
        showDialog("V√ì DECO DIZ:", "Pegue o viol√£o!").then(() => {
          violaoDesbloqueado = true;
          telaViolaoAberta = true;
          somPrincipal.pause();
          somPrincipal.currentTime = 0;
          document.getElementById("violao-screen").style.display = "flex";
          atualizarBotaoViolao('sim');
        });
      }, 300);
    } else if (resposta === 'nao') {
      setTimeout(() => {
        showDialog("V√ì DECO DIZ:", "Humm, mas pegue mesmo assim, fica bem em voc√™.").then(() => {
          violaoDesbloqueado = true;
          telaViolaoAberta = true;
          somPrincipal.pause();
          somPrincipal.currentTime = 0;
          document.getElementById("violao-screen").style.display = "flex";
          atualizarBotaoViolao('nao');
        });
      }, 300);
    }
  }

  function atualizarBotaoViolao(tipo) {
    const btn = document.querySelector(".btn-solta-som");
    if (tipo === 'sim') {
      btn.innerText = "üé∏ SOLTA O SOM! üé∏";
      btn.onclick = () => tocandoViolao();
    } else if (tipo === 'nao') {
      btn.innerText = "Voc√™ n√£o sabe tocar... üòÖ";
      btn.onclick = () => fecharTelaViolaoSemTocar();
    }
  }

  function tocandoViolao() {
    const btn = document.querySelector(".btn-solta-som");
    btn.disabled = true;
    
    somviolao.currentTime = 0;
    somviolao.play().catch(e => console.log("Som viol√£o n√£o dispon√≠vel"));
    
    const textoBotaoAnterior = btn.innerText;
    btn.innerText = "üéµ Tocando... üéµ";
    
    setTimeout(() => {
      somviolao.pause();
      somviolao.currentTime = 0;
      btn.innerText = textoBotaoAnterior;
      btn.disabled = false;
    }, 10000);
  }

  function fecharTelaViolao() {
    somviolao.pause();
    somviolao.currentTime = 0;
    document.getElementById("violao-screen").style.display = "none";
    telaViolaoAberta = false;
    
    somPrincipal.currentTime = 0;
    somPrincipal.play().catch(e => console.log("M√∫sica principal n√£o dispon√≠vel"));
    
    setTimeout(() => {
      if (violaoRespostaUsuario === 'sim') {
        showDialog("V√ì DECO DIZ:", "Nossa! Voc√™ toca muito bem.").then(() => {
          showDialog("V√ì DECO DIZ:", "Toca como meu filho! Fique com o viol√£o.").then(() => {
            finalizarViolaoEvent();
          });
        });
      } else if (violaoRespostaUsuario === 'nao') {
        showDialog("V√ì DECO DIZ:", "Que pena, mas fique para voc√™, quem sabe aprende a tocar como meu filho!").then(() => {
          finalizarViolaoEvent();
        });
      }
    }, 300);
  }

  function fecharTelaViolaoSemTocar() {
    somviolao.pause();
    somviolao.currentTime = 0;
    document.getElementById("violao-screen").style.display = "none";
    telaViolaoAberta = false;
    
    somPrincipal.currentTime = 0;
    somPrincipal.play().catch(e => console.log("M√∫sica principal n√£o dispon√≠vel"));
    
    setTimeout(() => {
      showDialog("V√ì DECO DIZ:", "Que pena, mas fique para voc√™, quem sabe aprende a tocar como meu filho!").then(() => {
        finalizarViolaoEvent();
      });
    }, 300);
  }

  function finalizarViolaoEvent() {
    inventoryItems[1] = 'violao';
    inventoryUnlocked = true;
    
    document.getElementById("violao").style.display = "none";
    
    const notification = document.getElementById("inventory-notification");
    notification.innerHTML = "‚ú® VIOL√ÉO ADICIONADO AO INVENT√ÅRIO!";
    notification.style.display = "block";
    document.getElementById("inventory-button").style.display = "block";
    
    setTimeout(() => {
      notification.style.display = "none";
    }, 5000);
    
    canExitLevel4 = true;
    exitArrowVisible = true;
    document.getElementById("exit-arrow").style.display = "block";
    
    vodecoDInteractionActive = false;
    vodecoDInteractionCompleted = true;
    document.getElementById("interaction-prompt").style.display = "none";
    violaoDesbloqueado = false;
    gameActive = true;
    gameLoop();
  }

  function verificarSaidaLevel4() {
    if (posX >= window.innerWidth - 100) {
      iniciarTransicaoLevel5();
    }
  }

  // ========== N√çVEL 5 - TABERNA COM TIA D E TIO GUIGO ==========

  function iniciarTransicaoLevel5() {
    gameActive = false;
    cutsceneActive = true;
    level4Active = false;
    
    document.getElementById("vodeco").style.display = "none";
    document.getElementById("violao").style.display = "none";
    document.getElementById("exit-arrow").style.display = "none";
    document.getElementById("interaction-prompt").style.display = "none";
    
    const gameScreen = document.getElementById("game-screen");
    gameScreen.style.transition = "none";
    gameScreen.style.background = "#000000";

    setTimeout(() => {
      gameScreen.style.transition = "background 1.5s ease-in-out";
      gameScreen.style.background = '#87CEEB url("background_4.png") no-repeat bottom center';
      gameScreen.style.backgroundSize = "cover";

        ground = window.innerHeight * 0.40;
      posY = ground; // ‚úÖ AGORA HEITOR COME√áA NO CH√ÉO
      posX = -150;
      velocityX = 0;
      velocityY = 0;
      direction = 1;
      isJumping = false;
      coyoteTime = 0;
      jumpBuffer = 0;

      setTimeout(() => {
        const heitorContainer = document.getElementById("heitor-container");
        heitorContainer.style.display = "block";
        heitorContainer.style.transition = "none";
        updateVisuals();

        somPrincipal.pause();
        somPrincipal.currentTime = 0;
        
        setTimeout(() => {
          somTaberna.currentTime = 0;
          somTaberna.play().catch(e => console.log("M√∫sica da taberna ainda n√£o dispon√≠vel"));
        }, 100);

        cutsceneActive = true;
        const enterGame = () => {
          posX += 5;
          updateVisuals();
          
          if (posX < window.innerWidth * 0.25) {
            requestAnimationFrame(enterGame);
          } else {
            cutsceneActive = false;
            setTimeout(() => {
              gameScreen.style.transition = "none";
              level5Active = true;
              gameActive = true;
              posicionarNPCsLevel5();
              gameLoop();
            }, 300);
          }
        };

        enterGame();

      }, 800);

    }, 300);
  }

  function posicionarNPCsLevel5() {
    const tiad = document.getElementById("tiad");
    const tioguigo = document.getElementById("tioguigo");
    
    tiad.style.display = "block";
    tioguigo.style.display = "block";
    
    tiaDX = window.innerWidth * 0.35;
    tiaDY = ground - 50;
    
    tioGuigoDX = window.innerWidth * 0.65;
    tioGuigoDY = ground - 50;
    
    tiad.style.left = tiaDX + "px";
    tiad.style.bottom = tiaDY + "px";
    tiad.style.transform = "scaleX(-1)";
    
    tioguigo.style.left = tioGuigoDX + "px";
    tioguigo.style.bottom = tioGuigoDY + "px";
    tioguigo.style.transform = "scaleX(-1)";
  }

  function verificarProximidadeTiaDInicial() {
    const distancia = Math.abs(posX - tiaDX);
    
    if (distancia < 250 && !tiaDDialogInicial) {
      tiaDDialogInicial = true;
      gameActive = false;
      iniciarDialogoInicial();
    }
  }

  async function iniciarDialogoInicial() {
    await showDialog("TIA ANDREZA DIZ:", "Ol√° jovem guerreiro! Bem vindo a minha taberna.");
    await showDialog("TIA ANDREZA DIZ:", "Desfrute das bebidas e do excelente pastel!");
    
    tiaDInteractionCompleted = true;
    gameActive = true;
    gameLoop();
  }

  function verificarProximidadeTiaDInteracao() {
    const distancia = Math.abs(posX - tiaDX);
    const prompt = document.getElementById("interaction-prompt");
    
    if (distancia < 200) {
      // Se j√° existe outro NPC mais pr√≥ximo, n√£o mostrar prompt
      if (proximoNPC && proximoNPC !== 'tiaD') {
        return;
      }
      
      proximoNPC = 'tiaD';
      prompt.style.display = "block";
      prompt.style.left = (tiaDX - 120) + "px";
      prompt.style.bottom = (tiaDY + 250) + "px";
    } else {
      // Se este era o NPC pr√≥ximo, limpar
      if (proximoNPC === 'tiaD') {
        proximoNPC = null;
        prompt.style.display = "none";
      }
    }
  }

  function iniciarInteracaoTiaD() {
    if (proximoNPC !== 'tiaD') return;
    if (!level5Active || !tiaDInteractionCompleted || tiaDInteractionActive) return;
    
    const distancia = Math.abs(posX - tiaDX);
    if (distancia < 200) {
      tiaDInteractionActive = true;
      gameActive = false;
      proximoNPC = null;
      document.getElementById("interaction-prompt").style.display = "none";
      
      // If Tia Aline interaction is available (after she calls Heitor), show new dialogue
      if (tiaAlineInteractionAvailable) {
        showDialog("TIA ANDREZA DIZ:", "Desculpe garoto! N√£o estamos conseguindo funcionarios e estou com a cabe√ßa cheia.").then(() => {
          finalizarInteracaoTiaD();
        });
      } else {
        // Original dialogue before Tia Aline sequence
        showDialog("TIA ANDREZA DIZ:", "Queria cigarros melhores para fumar...").then(() => {
          showDialog("TIA ANDREZA DIZ:", "Ei! Voc√™ √© muito novo para fumar, eu n√£o deveria falar disso com voc√™.").then(() => {
            finalizarInteracaoTiaD();
          });
        });
      }
    }
  }

  function finalizarInteracaoTiaD() {
    tiaDInteractionActive = false;
    gameActive = true;
    gameLoop();
  }

  function verificarProximidadeTioGuigo() {
    const distancia = Math.abs(posX - tioGuigoDX);
    const prompt = document.getElementById("interaction-prompt");
    
    if (tioGuigoInteractionCompleted) {
      if (proximoNPC === 'tioGuigo') {
        proximoNPC = null;
        prompt.style.display = "none";
      }
      return;
    }
    
    if (distancia < 200) {
      // Se j√° existe outro NPC mais pr√≥ximo, n√£o mostrar prompt
      if (proximoNPC && proximoNPC !== 'tioGuigo') {
        return;
      }
      
      proximoNPC = 'tioGuigo';
      prompt.style.display = "block";
      prompt.style.left = (tioGuigoDX - 120) + "px";
      prompt.style.bottom = (tioGuigoDY + 250) + "px";
    } else {
      // Se este era o NPC pr√≥ximo, limpar
      if (proximoNPC === 'tioGuigo') {
        proximoNPC = null;
        prompt.style.display = "none";
      }
    }
  }

  function iniciarInteracaoTioGuigo() {
    if (proximoNPC !== 'tioGuigo') return;
    if (!level5Active || tioGuigoInteractionActive || tioGuigoInteractionCompleted) return;
    
    const distancia = Math.abs(posX - tioGuigoDX);
    if (distancia < 200) {
      tioGuigoInteractionActive = true;
      gameActive = false;
      proximoNPC = null;
      document.getElementById("interaction-prompt").style.display = "none";
      
      showDialog("TIO GUIGO DIZ:", "Funcion√°rios! Eu estou t√£o irritado!").then(() => {
        showDialog("TIO GUIGO DIZ:", "√Çn que! Desculpe garoto, n√£o te vi ai.").then(() => {
          showDialog("TIO GUIGO DIZ:", "Esses funcionarios me tiram do serio! Hoje em dia √© t√£o dif√≠cil ganhar um suado dinheiro.").then(() => {
            mostrarPerguntaPerfumeGuigo();
          });
        });
      });
    }
  }

  function mostrarPerguntaPerfumeGuigo() {
    const choiceMenu = document.getElementById("choice-menu");
    const h3 = choiceMenu.querySelector("h3");
    const p = choiceMenu.querySelector("p");
    
    h3.innerText = "üëÉ TIO GUIGO DIZ üëÉ";
    p.innerText = "Garoto, voc√™ est√° cheirando mal... O que acha de um perfume?";
    choiceMenu.style.display = "block";
    
    const buttonsDiv = choiceMenu.querySelector(".choice-buttons");
    buttonsDiv.innerHTML = "";
    
    const btn1 = document.createElement("button");
    btn1.className = "choice-btn";
    btn1.innerText = "Sim!";
    btn1.onclick = () => escolherPerfumeGuigo('sim');
    
    const btn2 = document.createElement("button");
    btn2.className = "choice-btn";
    btn2.innerText = "N√£o!";
    btn2.onclick = () => escolherPerfumeGuigo('nao');
    
    buttonsDiv.appendChild(btn1);
    buttonsDiv.appendChild(btn2);
  }

  function escolherPerfumeGuigo(opcao) {
    const choiceMenu = document.getElementById("choice-menu");
    choiceMenu.style.display = "none";
    
    if (opcao === 'sim') {
      setTimeout(() => {
        showDialog("TIO GUIGO DIZ:", "Tome, voc√™ tem sorte que eu tenho uma fragr√¢ncia extra aqui.").then(() => {
          inventoryItems[2] = 'perfume';
          mostrarNotificacaoPerfume();
          finalizarInteracaoTioGuigo();
        });
      }, 300);
    } else if (opcao === 'nao') {
      setTimeout(() => {
        showDialog("TIO GUIGO DIZ:", "Voc√™ tem certeza?? Tenho um perfume √≥timo para voc√™! √â por conta da casa.").then(() => {
          mostrarConfirmacaoPerfumeGuigo();
        });
      }, 300);
    }
  }

  function mostrarConfirmacaoPerfumeGuigo() {
    const choiceMenu = document.getElementById("choice-menu");
    const p = choiceMenu.querySelector("p");
    
    p.innerText = "Tem certeza mesmo?";
    choiceMenu.style.display = "block";
    
    const buttonsDiv = choiceMenu.querySelector(".choice-buttons");
    buttonsDiv.innerHTML = "";
    
    const btn1 = document.createElement("button");
    btn1.className = "choice-btn";
    btn1.innerText = "T√° bem, vou aceitar!";
    btn1.onclick = () => {
      choiceMenu.style.display = "none";
      setTimeout(() => {
        showDialog("TIO GUIGO DIZ:", "√ìtimo! Quando precisar estou aqui.").then(() => {
          inventoryItems[2] = 'perfume';
          mostrarNotificacaoPerfume();
          finalizarInteracaoTioGuigo();
        });
      }, 300);
    };
    
    const btn2 = document.createElement("button");
    btn2.className = "choice-btn";
    btn2.innerText = "N√£o, tenho certeza!";
    btn2.onclick = () => {
      choiceMenu.style.display = "none";
      setTimeout(() => {
        showDialog("TIO GUIGO DIZ:", "Ok, √© de sua escolha feder!").then(() => {
          finalizarInteracaoTioGuigo();
        });
      }, 300);
    };
    
    buttonsDiv.appendChild(btn1);
    buttonsDiv.appendChild(btn2);
  }

  function mostrarNotificacaoPerfume() {
    const notification = document.getElementById("inventory-notification");
    notification.innerHTML = "‚ú® PERFUME ADICIONADO AO INVENT√ÅRIO!";
    notification.style.display = "block";
    
    setTimeout(() => {
      notification.style.display = "none";
    }, 5000);
  }

  function finalizarInteracaoTioGuigo() {
    tioGuigoInteractionActive = false;
    tioGuigoInteractionCompleted = true;
    document.getElementById("interaction-prompt").style.display = "none";
    exitArrowVisible = true;
    document.getElementById("exit-arrow").style.display = "block";
    gameActive = true;
    gameLoop();
  }

  function verificarSaidaLevel5() {
    // Trigger Tia Aline sequence when player approaches exit arrow (before exiting)
    if (posX >= window.innerWidth - 200 && !tiaAlineSequenceTriggered && exitArrowVisible) {
      tiaAlineSequenceTriggered = true;
      gameActive = false;
      exitArrowVisible = false;
      document.getElementById("exit-arrow").style.display = "none";
      iniciarSequenciaTiaAline();
      return;
    }
    
    // Normal exit after Tia Aline sequence is complete - transition to Level 6
    if (posX >= window.innerWidth - 100 && tiaAlineInteractionCompleted) {
      iniciarTransicaoLevel6();
    }
  }

  async function iniciarSequenciaTiaAline() {
    // Show initial dialogue
    await showDialog("TIA ALINE:", "Espereeee garoto!");
    
    // Position Tia Aline on the left side and animate her entrance
    posicionarTiaAline();
    
    // Continue dialogue sequence
    await showDialog("TIA ALINE:", "Andreza! Como voc√™ n√£o oferece um pastel de cortesia para o garoto!");
    await showDialog("TIA ANDREZA:", "Aline, eu esqueci, estou com tantas coisas na cabe√ßa.");
    await showDialog("TIA ALINE:", "Garoto, vem aqui!");
    
    // After dialogues, enable free control and interaction with Tia Aline
    tiaAlineInteractionAvailable = true;
    gameActive = true;
    gameLoop();
  }

  function posicionarTiaAline() {
    const tialine = document.getElementById("tialine");
    tialine.style.display = "block";
    
    // Start from the left side
    tiaAlineX = -200;
    tiaAlineY = ground - 50;
    
    tialine.style.left = tiaAlineX + "px";
    tialine.style.bottom = tiaAlineY + "px";
    tialine.style.transform = "scaleX(1)";
    
    // Animate entrance to center-left position
    const targetX = window.innerWidth * 0.25;
    
    const animateEntrance = () => {
      if (tiaAlineX < targetX) {
        tiaAlineX += 5;
        tialine.style.left = tiaAlineX + "px";
        requestAnimationFrame(animateEntrance);
      }
    };
    
    animateEntrance();
  }

  function verificarProximidadeTiaAline() {
    const distancia = Math.abs(posX - tiaAlineX);
    const prompt = document.getElementById("interaction-prompt");
    
    if (!tiaAlineInteractionAvailable || tiaAlineInteractionCompleted) {
      if (proximoNPC === 'tiaAline') {
        proximoNPC = null;
        prompt.style.display = "none";
      }
      return;
    }
    
    if (distancia < 200) {
      // Se j√° existe outro NPC mais pr√≥ximo, n√£o mostrar prompt
      if (proximoNPC && proximoNPC !== 'tiaAline') {
        return;
      }
      
      proximoNPC = 'tiaAline';
      prompt.style.display = "block";
      prompt.style.left = (tiaAlineX - 120) + "px";
      prompt.style.bottom = (tiaAlineY + 250) + "px";
    } else {
      // Se este era o NPC pr√≥ximo, limpar
      if (proximoNPC === 'tiaAline') {
        proximoNPC = null;
        prompt.style.display = "none";
      }
    }
  }

  async function iniciarInteracaoTiaAline() {
    if (proximoNPC !== 'tiaAline') return;
    if (!level5Active || !tiaAlineInteractionAvailable || tiaAlineInteractionActive || tiaAlineInteractionCompleted) return;
    
    const distancia = Math.abs(posX - tiaAlineX);
    if (distancia < 200) {
      tiaAlineInteractionActive = true;
      gameActive = false;
      proximoNPC = null;
      document.getElementById("interaction-prompt").style.display = "none";
      
      // New dialogue sequence
      await showDialog("TIA ALINE:", "Pe√ßo perd√£o pela gerencia...");
      await showDialog("TIA ALINE:", "Sou a Aline, a Taberneira... E fa√ßo √≥timos Drink's.");
      await showDialog("TIA ALINE:", "Tome esse pastel pelo transtorno, e vou fazer um Drink para voc√™!");
      
      // Show drink selection menu
      mostrarMenuDrinks();
    }
  }
  
  function mostrarMenuDrinks() {
    const choiceMenu = document.getElementById("choice-menu");
    const h3 = choiceMenu.querySelector("h3");
    const p = choiceMenu.querySelector("p");
    
    h3.innerText = "üçπ TIA ALINE PERGUNTA üçπ";
    p.innerText = "Escolha com sabedoria rapaz!";
    choiceMenu.style.display = "block";
    
    const buttonsDiv = choiceMenu.querySelector(".choice-buttons");
    buttonsDiv.innerHTML = "";
    
    const btnMoscow = document.createElement("button");
    btnMoscow.className = "choice-btn";
    btnMoscow.innerText = "Moscow Mule";
    btnMoscow.onclick = () => escolherDrink('moscowmule');
    
    const btnPina = document.createElement("button");
    btnPina.className = "choice-btn";
    btnPina.innerText = "Pi√±a Colada";
    btnPina.onclick = () => escolherDrink('pinacolada');
    
    const btnRecusar = document.createElement("button");
    btnRecusar.className = "choice-btn";
    btnRecusar.innerText = "Recusar";
    btnRecusar.onclick = () => escolherDrink('recusar');
    
    buttonsDiv.appendChild(btnMoscow);
    buttonsDiv.appendChild(btnPina);
    buttonsDiv.appendChild(btnRecusar);
  }
  
 async function escolherDrink(opcao) {
    const choiceMenu = document.getElementById("choice-menu");
    choiceMenu.style.display = "none";
    
    if (opcao === 'moscowmule') {
      // Player chooses Moscow Mule
      await showDialog("TIA ALINE:", "√ìtima escolha! Aproveite!");
      
      // Add pastel and moscow mule to inventory
      adicionarItensAoInventario('pastel', 'moscowmule');
    } else if (opcao === 'pinacolada') {
      // Player chooses Pi√±a Colada
      await showDialog("TIA ALINE:", "Excelente escolha! Aproveite!");
      
      // Add pastel and pina colada to inventory
      adicionarItensAoInventario('pastel', 'pinacolada');
    } else if (opcao === 'recusar') {
      // Player refuses, but gets a drink anyway
      await showDialog("TIA ALINE:", "Tadinho, ele n√£o sabe o que diz. Pressione E");
      await showDialog("TIA ALINE:", "Fiz um especial para voc√™ GAROTO!");
      
      // Add pastel and a special mystery drink to inventory
      adicionarItensAoInventario('pastel', 'drink');
    }
    
    finalizarInteracaoTiaAline();
  }
  
  function adicionarItensAoInventario(item1, item2) {
    let item1Added = false;
    let item2Added = false;
    
    for (let i = 0; i < inventoryItems.length; i++) {
      if (!item1Added && inventoryItems[i] === null) {
        inventoryItems[i] = item1;
        item1Added = true;
        continue;
      }
      if (!item2Added && inventoryItems[i] === null) {
        inventoryItems[i] = item2;
        item2Added = true;
      }
      
      if (item1Added && item2Added) break;
    }
    
    // Show notification based on what was added
    const notification = document.getElementById("inventory-notification");
    let item2Name = 'BEBIDA';
    
    if (item2 === 'moscowmule') {
      item2Name = 'MOSCOW MULE';
    } else if (item2 === 'pinacolada') {
      item2Name = 'PI√ëA COLADA';
    } else if (item2 === 'drink') {
      item2Name = 'BEBIDA ESPECIAL';
    }
    
    if (item1Added && item2Added) {
      notification.innerHTML = `‚ú® PASTEL E ${item2Name} ADICIONADOS AO INVENT√ÅRIO!`;
    } else if (item1Added) {
      notification.innerHTML = "‚ú® PASTEL ADICIONADO AO INVENT√ÅRIO!";
    } else if (item2Added) {
      notification.innerHTML = `‚ú® ${item2Name} ADICIONADO AO INVENT√ÅRIO!`;
    } else {
      notification.innerHTML = "‚ö†Ô∏è INVENT√ÅRIO CHEIO!";
    }
    notification.style.display = "block";
    
    setTimeout(() => {
      notification.style.display = "none";
    }, 5000);
  }

  function finalizarInteracaoTiaAline() {
    tiaAlineInteractionActive = false;
    tiaAlineInteractionCompleted = true;
    document.getElementById("interaction-prompt").style.display = "none";
    exitArrowVisible = true;
    document.getElementById("exit-arrow").style.display = "block";
    gameActive = true;
    gameLoop();
  }

  function finalizarJogo() {
    gameActive = false;
    cutsceneActive = true;
    level5Active = false;
    
    somTaberna.pause();
    somTaberna.currentTime = 0;
    
    const gameScreen = document.getElementById("game-screen");
    gameScreen.style.background = "#000000";
    
    setTimeout(() => {
      const dialogBox = document.getElementById("dialog-box");
      dialogBox.style.display = "block";
      
      showDialog("üèÜ FIM DA AVENTURA üèÜ", 
                 "Voc√™ completou uma jornada √©pica, Heitor!\n\nVoc√™ enfrentou desafios, fez novos amigos e descobriu o verdadeiro valor da amizade e coragem.\n\nQue sua pr√≥xima aventura seja ainda maior!\n\nTE AMAMOS, HEITOR! üíñ").then(() => {
        dialogBox.style.display = "none";
        voltarAoMenu();
      });
    }, 1000);
  }

  // ========== N√çVEL 6 - PLATAFORMA MUSICAL ==========

  function iniciarTransicaoLevel6() {
    gameActive = false;
    cutsceneActive = true;
    level5Active = false;
    
    // Remove NPCs da Taberna
    document.getElementById("tiad").style.display = "none";
    document.getElementById("tioguigo").style.display = "none";
    document.getElementById("tialine").style.display = "none";
    document.getElementById("exit-arrow").style.display = "none";
    document.getElementById("interaction-prompt").style.display = "none";
    
    // PARAR TODAS as trilhas de m√∫sica anteriores
    somMenu.pause();
    somMenu.currentTime = 0;
    somPrincipal.pause();
    somPrincipal.currentTime = 0;
    somTaberna.pause();
    somTaberna.currentTime = 0;
    somBatalha.pause();
    somBatalha.currentTime = 0;
    somjokenpo.pause();
    somjokenpo.currentTime = 0;
    
    const gameScreen = document.getElementById("game-screen");
    gameScreen.style.transition = "none";
    gameScreen.style.background = "#000000";

    setTimeout(() => {
      gameScreen.style.transition = "background 1.5s ease-in-out";
      gameScreen.style.background = "url('background_5.png') no-repeat center bottom";
      gameScreen.style.backgroundSize = "cover";

      setTimeout(() => {
        posX = window.innerWidth * 0.15;
        posY = ground;
        
        const heitorContainer = document.getElementById("heitor-container");
        heitorContainer.style.display = "block";
        heitorContainer.style.transition = "none";
        updateVisuals();

        // Tocar APENAS trilha5.mp3 em loop
        setTimeout(() => {
          trilha5.currentTime = 0;
          trilha5.play().catch(e => console.log("Trilha 5 ainda n√£o dispon√≠vel"));
        }, 100);

        cutsceneActive = true;
        
        // Mostrar mensagem inicial
        setTimeout(async () => {
          await showDialog("NARRADOR:", "Heitor est√° escutando uma linda melodia, parece que est√° vindo do rapaz √† esquerda.");
          
          cutsceneActive = false;
          level6Active = true;
          gameActive = true;
          posicionarNPCsLevel6();
          gameLoop();
        }, 500);

      }, 800);

    }, 300);
  }

  function posicionarNPCsLevel6() {
    const tiobruno = document.getElementById("tiobruno");
    const vomari = document.getElementById("vomari");
    
    tiobruno.style.display = "block";
    vomari.style.display = "block";
    
    // Tio Bruno √† esquerda
    tiobrunoX = window.innerWidth * 0.25;
    tiobrunoY = ground - 20;
    
    // Vomari √† direita
    vomariX = window.innerWidth * 0.75;
    vomariY = ground - 20;
    
    tiobruno.style.left = tiobrunoX + "px";
    tiobruno.style.bottom = tiobrunoY + "px";
    
    vomari.style.left = vomariX + "px";
    vomari.style.bottom = vomariY + "px";
  }

  function verificarProximidadeTioBruno() {
    if (!level6Active || tiobrunoInteractionActive || tiobrunoInteractionCompleted) return;
    
    const distancia = Math.abs(posX - tiobrunoX);
    
    if (distancia < NPC_PROXIMITY_THRESHOLD && proximoNPC !== 'tioBruno') {
      proximoNPC = 'tioBruno';
      const prompt = document.getElementById("interaction-prompt");
      prompt.style.display = "block";
      prompt.style.left = (tiobrunoX - 120) + "px";
      prompt.style.bottom = (ground + INTERACTION_PROMPT_OFFSET) + "px";
    } else if (distancia >= NPC_PROXIMITY_THRESHOLD && proximoNPC === 'tioBruno') {
      proximoNPC = null;
      document.getElementById("interaction-prompt").style.display = "none";
    }
  }

  function verificarProximidadeVomari() {
    if (!level6Active || vomariInteractionActive || vomariInteractionCompleted) return;
    
    const distancia = Math.abs(posX - vomariX);
    
    if (distancia < NPC_PROXIMITY_THRESHOLD && proximoNPC !== 'vomari') {
      proximoNPC = 'vomari';
      const prompt = document.getElementById("interaction-prompt");
      prompt.style.display = "block";
      prompt.style.left = (vomariX - 120) + "px";
      prompt.style.bottom = (ground + INTERACTION_PROMPT_OFFSET) + "px";
    } else if (distancia >= NPC_PROXIMITY_THRESHOLD && proximoNPC === 'vomari') {
      proximoNPC = null;
      document.getElementById("interaction-prompt").style.display = "none";
    }
  }

  function verificarSaidaLevel6() {
    // Preparar sa√≠da para pr√≥ximos n√≠veis (a ser implementado)
    if (posX >= window.innerWidth - 100) {
      // Placeholder para transi√ß√£o futura
      finalizarJogo();
    }
  }

  async function iniciarInteracaoTioBruno() {
    if (proximoNPC !== 'tioBruno') return;
    if (!level6Active || tiobrunoInteractionActive || tiobrunoInteractionCompleted) return;
    
    const distancia = Math.abs(posX - tiobrunoX);
    if (distancia < NPC_PROXIMITY_THRESHOLD) {
      tiobrunoInteractionActive = true;
      gameActive = false;
      proximoNPC = null;
      document.getElementById("interaction-prompt").style.display = "none";
      
      // Di√°logos iniciais do Tio Bruno
      await showDialog("TIO BRUNO:", "Ol√°, pequeno Heitor! Que prazer te ver aqui!");
      await showDialog("TIO BRUNO:", "Estou aqui tocando minhas m√∫sicas favoritas nesta plataforma musical.");
      await showDialog("TIO BRUNO:", "Voc√™ sabe, eu adoro cantar rimas sobre nossa fam√≠lia e nossas aventuras!");
      await showDialog("TIO BRUNO:", "Quer ouvir uma das minhas composi√ß√µes? Tenho v√°rias no meu repert√≥rio!");
      
      // Abrir menu de repert√≥rio
      abrirMenuRepertorioBruno();
    }
  }

  function finalizarInteracaoTioBruno() {
    tiobrunoInteractionActive = false;
    tiobrunoInteractionCompleted = true;
    document.getElementById("interaction-prompt").style.display = "none";
    gameActive = true;
    gameLoop();
  }

  function abrirMenuRepertorioBruno() {
    const menu = document.getElementById("bruno-repertorio-menu");
    menu.style.display = "flex";
  }

  function fecharMenuRepertorioBruno() {
    const menu = document.getElementById("bruno-repertorio-menu");
    menu.style.display = "none";
    
    // Se uma rima foi selecionada, finalizar a intera√ß√£o
    if (brunoRepertorioSelecionado) {
      setTimeout(() => {
        showDialog("TIO BRUNO:", "Espero que tenha gostado da minha apresenta√ß√£o!").then(() => {
          showDialog("TIO BRUNO:", "Volte sempre que quiser ouvir mais! A m√∫sica nos une!").then(() => {
            finalizarInteracaoTioBruno();
          });
        });
      }, 300);
    } else {
      // Se n√£o selecionou nada, volta sem finalizar completamente
      setTimeout(() => {
        showDialog("TIO BRUNO:", "Ah, que pena... Mas estou aqui se mudar de ideia!").then(() => {
          finalizarInteracaoTioBruno();
        });
      }, 300);
    }
  }

  async function escolherRepertorioBruno(tipo) {
    brunoRepertorioSelecionado = tipo;
    
    // Fechar o menu
    const menu = document.getElementById("bruno-repertorio-menu");
    menu.style.display = "none";
    
    // Mensagem de prepara√ß√£o
    await showDialog("TIO BRUNO:", "√ìtima escolha! Deixa eu preparar minha voz...");
    await showDialog("TIO BRUNO:", "L√° vai! Presta aten√ß√£o na letra!");
    
    // Iniciar o canto
    await cantarRimaBruno();
  }

  async function cantarRimaBruno() {
    const tipo = brunoRepertorioSelecionado;
    
    // Ativar overlay visual
    const overlay = document.getElementById("bruno-canto-overlay");
    overlay.style.display = "block";
    
    // Definir rimas baseadas no tipo selecionado
    const rimas = {
      'tina': {
        titulo: "üé≠ Rima da Tina üé≠",
        versos: [
          "Era uma vez uma gata chamada Tina,",
          "Que adorava arranhar de manh√£ √† tardinha!",
          "Com suas garras afiadas e jeito sapeca,",
          "Fazia todo mundo correr pra biblioteca!",
          "Mas no fundo era doce, s√≥ queria brincar,",
          "E quando dormia, s√≥ sabia ronronar!"
        ]
      },
      'laura': {
        titulo: "üë∏ Rima da Laura üë∏",
        versos: [
          "Laura √© a princesa das c√≥cegas sem igual,",
          "Ri tanto que at√© esquece o mal!",
          "Quando algu√©m faz c√≥cegas em seus pezinhos,",
          "Solta risadas que parecem passarinhos!",
          "√â a alegria da casa, sempre a sorrir,",
          "Com sua risada contagiante a nos curtir!"
        ]
      },
      'churros': {
        titulo: "üç™ Rima dos Churros üç™",
        versos: [
          "V√≥ Didi faz churros de doce de leite,",
          "Com uma receita que √© puro deleite!",
          "Crocante por fora, macio por dentro,",
          "√â imposs√≠vel comer s√≥ um, eu garanto!",
          "O segredo √© o amor que ela coloca,",
          "Por isso que todo mundo adora e se arroca!"
        ]
      },
      'violao': {
        titulo: "üé∏ Rima do Viol√£o üé∏",
        versos: [
          "V√≥ Deco tinha um viol√£o especial,",
          "Que tocava m√∫sicas do bem e do mal!",
          "Era heran√ßa de seu filho querido,",
          "Que hoje vive em nosso cora√ß√£o sentido.",
          "Cada corda conta uma hist√≥ria de amor,",
          "E quando toca, afasta qualquer dor!"
        ]
      },
      'taberna': {
        titulo: "üç∫ Rima da Taberna üç∫",
        versos: [
          "Na taberna o caos √© organizado,",
          "Com drinks e comidas de todo lado!",
          "Tio Guigo vende perfumes refinados,",
          "Enquanto Tia Aline serve drinks bem gelados!",
          "√â um lugar de risadas e confus√£o,",
          "Onde todos se sentem no cora√ß√£o!"
        ]
      }
    };
    
    const rimaEscolhida = rimas[tipo];
    
    if (rimaEscolhida) {
      // T√≠tulo da rima
      await showDialog("TIO BRUNO CANTA:", rimaEscolhida.titulo);
      
      // Cantar cada verso com efeito
      for (let i = 0; i < rimaEscolhida.versos.length; i++) {
        await showDialog("TIO BRUNO:", rimaEscolhida.versos[i]);
        
        // Pequena pausa entre versos para dar ritmo
        await new Promise(resolve => setTimeout(resolve, 300));
      }
      
      // Finaliza√ß√£o do canto
      await showDialog("TIO BRUNO:", "üéµ *Termina com um acorde perfeito* üéµ");
    }
    
    // Desativar overlay visual ap√≥s o canto
    overlay.style.display = "none";
    
    // Mensagem final
    await showDialog("TIO BRUNO:", "E a√≠, gostou? Eu adoro cantar essas hist√≥rias!");
  }

  async function iniciarInteracaoVomari() {
    if (proximoNPC !== 'vomari') return;
    if (!level6Active || vomariInteractionActive || vomariInteractionCompleted) return;
    
    const distancia = Math.abs(posX - vomariX);
    if (distancia < NPC_PROXIMITY_THRESHOLD) {
      vomariInteractionActive = true;
      gameActive = false;
      proximoNPC = null;
      document.getElementById("interaction-prompt").style.display = "none";
      
      // Placeholder dialogue - pode ser customizado depois
      await showDialog("VOMARI:", "E a√≠, Heitor!");
      await showDialog("VOMARI:", "Bem-vindo √† nossa plataforma musical!");
      
      finalizarInteracaoVomari();
    }
  }

  function finalizarInteracaoVomari() {
    vomariInteractionActive = false;
    vomariInteractionCompleted = true;
    document.getElementById("interaction-prompt").style.display = "none";
    gameActive = true;
    gameLoop();
  }

  function voltarAoMenu() {
    stage = 0;
    gameActive = false;
    battleActive = false;
    level2Active = false;
    level3Active = false;
    level4Active = false;
    level5Active = false;
    level6Active = false;
    
    posX = window.innerWidth * 0.4;
    posY = -300;
    ground = window.innerHeight * 0.40;
    
    inventoryUnlocked = true;
    
    document.getElementById("game-screen").style.display = "none";
    document.getElementById("menu-screen").style.display = "flex";
    
    somMenu.pause();
    somPrincipal.pause();
    somTaberna.pause();
    somBatalha.pause();
    somjokenpo.pause();
    trilha5.pause();
    
    somMenu.currentTime = 0;
    somPrincipal.currentTime = 0;
    somTaberna.currentTime = 0;
    somBatalha.currentTime = 0;
    somjokenpo.currentTime = 0;
    trilha5.currentTime = 0;
    
    somMenu.play().catch(e => console.log("M√∫sica do menu n√£o dispon√≠vel"));
  }

  // ========== INVENT√ÅRIO ==========

  function abrirInventario() {
    if (!inventoryUnlocked) return;
    
    const panel = document.getElementById("inventory-panel");
    panel.style.display = "block";
    
    const grid = document.getElementById("inventory-grid");
    grid.innerHTML = "";
    
    for (let i = 0; i < 7; i++) {
      const slot = document.createElement("div");
      slot.className = "inventory-slot";
      
      if (inventoryItems[i]) {
        slot.classList.remove("empty");
        slot.innerHTML = `<img src="${inventoryItems[i]}.png" alt="${inventoryItems[i]}">`;
        slot.onclick = () => abrirViewerItem(i);
      } else {
        slot.classList.add("empty");
        slot.innerHTML = "";
      }
      
      grid.appendChild(slot);
    }
    
    document.getElementById("inventory-description").innerText = "Selecione um item para ver a descri√ß√£o";
  }

  function abrirViewerItem(index) {
    if (!inventoryItems[index]) return;
    
    const item = inventoryItems[index];
    const description = itemDescriptions[item] || "Item desconhecido";
    
    const viewer = document.getElementById("item-viewer");
    const imageDiv = document.getElementById("item-viewer-image");
    const descDiv = document.getElementById("item-viewer-description");
    
    imageDiv.innerHTML = `<img src="${item}.png" alt="${item}">`;
    descDiv.innerText = description;
    
    viewer.style.display = "flex";
  }

  function fecharViewerItem() {
    document.getElementById("item-viewer").style.display = "none";
  }

  function fecharInventario() {
    document.getElementById("inventory-panel").style.display = "none";
    selectedSlot = -1;
  }

  // ========== EVENT LISTENERS ==========

    document.addEventListener("keydown", (e) => {
    if (e.key.toLowerCase() === 'e') {
      if (level3Active) iniciarInteracaoVodidi();
      if (level4Active) iniciarInteracaoVodeco();
      if (level5Active) {
        if (proximoNPC === 'tiaD') iniciarInteracaoTiaD();
        else if (proximoNPC === 'tioGuigo') iniciarInteracaoTioGuigo();
        else if (proximoNPC === 'tiaAline') iniciarInteracaoTiaAline();
      }
      if (level6Active) {
        if (proximoNPC === 'tioBruno') iniciarInteracaoTioBruno();
        else if (proximoNPC === 'vomari') iniciarInteracaoVomari();
      }
    }
    
    if (e.key.toLowerCase() === 'i' && inventoryUnlocked) {
      const panel = document.getElementById("inventory-panel");
      if (panel.style.display === "none" || panel.style.display === "") {
        abrirInventario();
      } else {
        fecharInventario();
      }
    }
  });
</script>
</body>
</html>
